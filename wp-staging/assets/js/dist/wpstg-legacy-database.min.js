!function(){"use strict";function t(t,e,a,o,s,n,r){try{var i=t[n](r),l=i.value}catch(t){return void a(t)}i.done?e(l):Promise.resolve(l).then(o,s)}function e(e){return function(){var a=this,o=arguments;return new Promise((function(s,n){var r=e.apply(a,o);function i(e){t(r,s,n,i,l,"next",e)}function l(e){t(r,s,n,i,l,"throw",e)}i(void 0)}))}}function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o])}return t}).apply(this,arguments)}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,o=new Array(e);a<e;a++)o[a]=t[a];return o}function s(t,e){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function(t,e){if(t){if("string"==typeof t)return o(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var s=0;return function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(a=t[Symbol.iterator]()).next.bind(a)}!function(t){window.addEventListener("database-backups-tab",(function(){o.init()}));var o={type:null,isCancelled:!1,processInfo:{title:null,interval:null},cache:{elements:[],get:function(e){return-1!==t.inArray(e,this.elements)||(this.elements[e]=t(e)),this.elements[e]},refresh:function(e){e.elements[e]=t(e)}},init:function(){o.fetchListing(),this.create(),this.delete(),this.restore(),this.edit(),t("body").off("change","#wpstg--backups--filter").on("change","#wpstg--backups--filter",(function(){var e=t("#wpstg-existing-database-backups").find("> div[id][data-type].wpstg-backup");""===this.value?e.show():"database"===this.value?(e.filter('[data-type="site"]').hide(),e.filter('[data-type="database"]').show()):"site"===this.value&&(e.filter('[data-type="database"]').hide(),e.filter('[data-type="site"]').show())})).on("click",".wpstg--backup--download",(function(){var t=this.getAttribute("data-url");t.length>0?window.location.href=t:o.downloadModal({titleExport:this.getAttribute("data-title-export"),title:this.getAttribute("data-title"),id:this.getAttribute("data-id"),btnTxtCancel:this.getAttribute("data-btn-cancel-txt"),btnTxtConfirm:this.getAttribute("data-btn-download-txt")})})).off("click","#wpstg-import-backup").on("click","#wpstg-import-backup",(function(){o.importModal()})).off("click",".wpstg--backup--import--choose-option").on("click",".wpstg--backup--import--choose-option",(function(){var e=t(this).parent();e.hasClass("wpstg--show-options")?(e.removeClass("wpstg--show-options"),t(this).text(t(this).attr("data-txtOther"))):(e.addClass("wpstg--show-options"),t(this).text(t(this).attr("data-txtChoose")))})).off("click",".wpstg--modal--backup--import--search-replace--new").on("click",".wpstg--modal--backup--import--search-replace--new",(function(e){e.preventDefault();var a=t(Swal.getContainer()).find(".wpstg--modal--backup--import--search-replace--input--container"),s=a.find(".wpstg--modal--backup--import--search-replace--input-group").length;a.append(o.modal.import.searchReplaceForm.replace(/{i}/g,s))})).off("input",".wpstg--backup--import--search").on("input",".wpstg--backup--import--search",(function(){var t=parseInt(this.getAttribute("data-index"));isNaN(t)||(o.modal.import.data.search[t]=this.value)})).off("input",".wpstg--backup--import--replace").on("input",".wpstg--backup--import--replace",(function(){var t=parseInt(this.getAttribute("data-index"));isNaN(t)||(o.modal.import.data.replace[t]=this.value)})).off("click",".wpstg--backup--import--option[data-option]").on("click",".wpstg--backup--import--option[data-option]",(function(){var e=this.getAttribute("data-option");"file"!==e?("upload"===e&&(o.modal.import.containerFilesystem.hide(),o.modal.import.containerUpload.show(),t(".wpstg--backup--import--choose-option").click(),t(".wpstg--modal--backup--import--search-replace--wrapper").show()),"filesystem"===e&&(o.modal.import.containerUpload.hide(),o.modal.import.containerFilesystem.show(),fetch(ajaxurl+"?action=wpstg--backups--import--file-list&_="+Math.random()+"&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce).then(o.handleFetchErrors).then((function(t){return t.json()})).then((function(e){var a=t(".wpstg--modal--backup--import--filesystem ul");return a.empty(),!e||o.isEmpty(e)?(a.append('<span id="wpstg--backups--import--file-list-empty">No import file found! Upload an import file to the folder above.</span><br />'),void t(".wpstg--modal--backup--import--search-replace--wrapper").hide()):(a.append('<span id="wpstg--backups--import--file-list">Select file to import:</span><br />'),e.forEach((function(t,e){a.append('<li><label><input name="backup_import_file" type="radio" value="'+t.fullPath+'">'+t.name+" <br /> "+t.size+"</label></li>")})),e)})).catch((function(t){return o.showAjaxFatalError(t,"","Submit an error report.")})))):t('input[type="file"][name="wpstg--backup--import--upload--file"]').click()})).off("change",'input[type="file"][name="wpstg--backup--import--upload--file"]').on("change",'input[type="file"][name="wpstg--backup--import--upload--file"]',(function(){o.modal.import.setFile(this.files[0]||null),t(".wpstg--backup--import--choose-option").click()})).off("change",'input[type="radio"][name="backup_import_file"]').on("change",'input[type="radio"][name="backup_import_file"]',(function(){t(".wpstg--modal--actions .swal2-confirm").prop("disabled",!1),o.modal.import.data.file=this.value})).on("drag dragstart dragend dragover dragenter dragleave drop",".wpstg--modal--backup--import--upload--container",(function(t){t.preventDefault(),t.stopPropagation()})).on("dragover dragenter",".wpstg--modal--backup--import--upload--container",(function(){t(this).addClass("wpstg--has-dragover")})).on("dragleave dragend drop",".wpstg--modal--backup--import--upload--container",(function(){t(this).removeClass("wpstg--has-dragover")})).on("drop",".wpstg--modal--backup--import--upload--container",(function(t){o.modal.import.setFile(t.originalEvent.dataTransfer.files[0]||null)}))},create:function(){var s=function e(s){if(o.resetErrors(),!o.isCancelled){var n=s.reset;delete s.reset;var r=Object.assign({},s),i=!0;if("database"===s.type)o.type=s.type,delete r.includedDirectories,delete r.wpContentDir,delete r.availableDirectories,delete r.wpStagingDir,delete r.exportDatabase,delete r.includeOtherFilesInWpContent,r=o.requestData("tasks.backup.database.create",a({},r,{type:"manual"}));else{if("site"!==s.type)return o.type=null,Swal.close(),void o.showError("Invalid Backup Type");o.type=s.type,delete r.type,r=o.requestData("jobs.backup.site.create",r),i=!1,r.jobs.backup.site.create.directories=[s.wpContentDir],r.jobs.backup.site.create.excludedDirectories=s.availableDirectories.split("|").filter((function(t){return!s.includedDirectories.includes(t)})).map((function(t){return t})),r.jobs.backup.site.create.includeOtherFilesInWpContent=[s.includeOtherFilesInWpContent],delete r.jobs.backup.site.create.wpContentDir,delete r.jobs.backup.site.create.wpStagingDir,delete r.jobs.backup.site.create.availableDirectories}o.timer.start();var l=function(){console.log("Status: Stop"),clearInterval(o.processInfo.interval),o.processInfo.interval=null};WPStaging.ajax({action:"wpstg--backups--database-legacy-create",accessToken:wpstg.accessToken,nonce:wpstg.nonce,reset:n,wpstg:r},(function(a){if(void 0!==a)if(o.processResponse(a,i),i||o.processInfo.interval||null===o.processInfo.interval&&(console.log("Status: Start"),o.processInfo.interval=setInterval((function(){!0!==o.isCancelled?!1!==o.status.hasResponse&&(o.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce).then((function(t){return t.json()})).then((function(e){if(o.status.hasResponse=!0,void 0===e&&l(),o.processInfo.title!==e.currentStatusTitle){o.processInfo.title=e.currentStatusTitle;var a=t(Swal.getContainer());a.find(".wpstg--modal--process--title").text(e.currentStatusTitle),a.find(".wpstg--modal--process--percent").text("0")}})).catch((function(t){o.status.hasResponse=!0,o.showAjaxFatalError(t,"","Submit an error report.")}))):l()}),5e3)),!1===a.status)e(s);else if(!0===a.status){if(t("#wpstg--progress--status").text("Backup successfully created!"),o.type=null,o.messages.shouldWarn())return o.fetchListing(),void o.logsModal();l(),Swal.close(),o.fetchListing().then((function(){if(a.backupId){var e=t('.wpstg--backup--download[data-id="'+a.backupId+'"]');o.downloadModal({id:e.data("id"),url:e.data("url"),title:e.data("title"),titleExport:e.data("title-export"),btnTxtCancel:e.data("btn-cancel-txt"),btnTxtConfirm:e.data("btn-download-txt")}),t(".wpstg--modal--download--logs--wrapper").show();var s=t(".wpstg--modal--process--logs");o.messages.data.all.forEach((function(t){var e="wpstg--modal--process--msg--"+t.type.toLowerCase();s.append('<p class="'+e+'">['+t.type+"] - ["+t.date+"] - "+t.message+"</p>")}))}else o.showError("Failed to get backup ID from response")}))}else setTimeout((function(){e(s)}),wpstg.delayReq);else setTimeout((function(){e(s)}),wpstg.delayReq)}),"json",!1,0,1.25)}};t("body").off("click",'input[name="backup_type"]').on("click",'input[name="backup_type"]',(function(){var e=t(".wpstg-advanced-options");"database"!==this.value?e.show():e.hide()})).off("click",".wpstg--tab--toggle").on("click",".wpstg--tab--toggle",(function(){var e=t(t(this).attr("data-target"));e.toggle(),e.is(":visible")?t(this).find("span").text("▼"):t(this).find("span").text("►")})).off("change",'[name="includedDirectories[]"], [type="checkbox"][name="export_database"]').on("change",'[type="checkbox"][name="includedDirectories[]"], [type="checkbox"][name="export_database"]',(function(){var e=t('[type="checkbox"][name="includedDirectories[]"]:checked').length,a=1===t('[type="checkbox"][name="export_database"]:checked').length;e<1&&!a?t(".swal2-confirm").prop("disabled",!0):t(".swal2-confirm").prop("disabled",!1)})),t("#wpstg--tab--database-backups").off("click","#wpstg-new-database-backup").on("click","#wpstg-new-database-backup",function(){var a=e(regeneratorRuntime.mark((function e(a){var n,r,i,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.resetErrors(),a.preventDefault(),o.isCancelled=!1,o.modal.create.html&&o.modal.create.confirmBtnTxt||(n=t("#wpstg--modal--database--new"),r=n.html(),i=n.attr("data-confirmButtonText"),o.modal.create.html=r||null,o.modal.create.confirmBtnTxt=i||null,n.remove()),e.next=6,Swal.fire({title:"",html:o.modal.create.html,focusConfirm:!1,confirmButtonText:o.modal.create.confirmBtnTxt,showCancelButton:!0,preConfirm:function(){var t=Swal.getContainer();return{type:"database",name:t.querySelector('input[name="backup_name"]').value||null,notes:t.querySelector('textarea[name="backup_note"]').value||null,includedDirectories:Array.from(t.querySelectorAll('input[name="includedDirectories\\[\\]"]:checked')||[]).map((function(t){return t.value})),wpContentDir:t.querySelector('input[name="wpContentDir"]').value||null,availableDirectories:t.querySelector('input[name="availableDirectories"]').value||null,wpStagingDir:t.querySelector('input[name="wpStagingDir"]').value||null,exportDatabase:null!==t.querySelector('input[name="export_database"]:checked'),includeOtherFilesInWpContent:null!==t.querySelector('input[name="includeOtherFilesInWpContent"]:checked')}}});case 6:if(l=e.sent,c=l.value){e.next=10;break}return e.abrupt("return");case 10:c.reset=!0,o.process({execute:function(){o.messages.reset(),s(c)}});case 12:case"end":return e.stop()}}),e)})));return function(t){return a.apply(this,arguments)}}())},isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},isLoading:function(t){t&&!1!==t?o.cache.get(".wpstg-loader").show():o.cache.get(".wpstg-loader").hide()},showAjaxFatalError:function(t,e,a){return e=e?e+"<br/><br/>":"Something went wrong! <br/><br/>",a=a?a+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===t?(o.showError(e+" Error: No response."+a),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==t.error&&t.error?(console.error(t.message),o.showError(e+" Error: "+t.message+a),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},handleFetchErrors:function(t){return t.ok||o.showError("Error: "+t.status+" - "+t.statusText+". Please try again or contact support."),t},showError:function(e){o.cache.get("#wpstg-try-again").css("display","inline-block"),o.cache.get("#wpstg-cancel-cloning").text("Reset"),o.cache.get("#wpstg-resume-cloning").show(),o.cache.get("#wpstg-error-wrapper").show(),o.cache.get("#wpstg-error-details").show().html(e),o.cache.get("#wpstg-removing-clone").removeClass("loading"),o.cache.get(".wpstg-loader").hide(),t(".wpstg--modal--process--generic-problem").show().html(e)},resetErrors:function(){o.cache.get("#wpstg-error-details").hide().html("")},ajax:function(e,a,s,n,r,i){void 0===i&&(i=null),void 0===s&&(s="json"),!1!==n&&(n=!0);var l=10,c=1e4*(r=void 0===r?0:r);i=parseInt(i),isNaN(i)||(c*=i),t.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:s,cache:!1,data:e,error:function(t,p,u){if(console.log(t.status+" "+t.statusText+"---"+p),++r<=l)setTimeout((function(){o.ajax(e,a,s,n,r,i)}),c);else{var d=void 0===t.status?"Unknown":t.status;o.showError("Fatal Error:  "+d+" Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")}},success:function(t){"function"==typeof a&&a(t)},statusCode:{404:function(){r>=l&&o.showError("Error 404 - Can't find ajax request URL! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},500:function(){r>=l&&o.showError("Fatal Error 500 - Internal server error while processing the request! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},504:function(){r>l&&o.showError("Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},502:function(){r>=l&&o.showError("Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},503:function(){r>=l&&o.showError("Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},429:function(){r>=l&&o.showError("Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},403:function(){r>=l&&o.showError("Refresh page or login again! The process should be finished successfully. \n ")}}})},modal:{create:{html:null,confirmBtnTxt:null},process:{html:null,cancelBtnTxt:null,modal:null},download:{html:null},import:{html:null,btnTxtNext:null,btnTxtConfirm:null,btnTxtCancel:null,searchReplaceForm:null,file:null,containerUpload:null,containerFilesystem:null,setFile:function(e,a){void 0===a&&(a=!0);var s,n;e&&(o.modal.import.file=e,o.modal.import.data.file=e.name,console.log("File "+e.name),t(".wpstg--backup--import--selected-file").html(e.name+" <br /> ("+(s=e.size,n=Math.floor(Math.log(s)/Math.log(1024)),1*(s/Math.pow(1024,n)).toFixed(2)+" "+["B","kB","MB","GB","TB"][n]+")")).show(),t(".wpstg--drag").hide(),t(".wpstg--drag-or-upload").show(),a&&(t(".wpstg--modal--actions .swal2-confirm").prop("disabled",!0),o.upload.start()))},baseDirectory:null,data:{file:null,search:[],replace:[]}}},messages:{WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[]},shouldWarn:function(){return o.messages.data.error.length>0||o.messages.data.critical.length>0},countByType:function(t){return void 0===t&&(t=o.messages.ERROR),o.messages.data[t].length},addMessage:function(t){if(Array.isArray(t))t.forEach((function(t){o.messages.addMessage(t)}));else{var e=t.type.toLowerCase()||"info";o.messages.data[e]||(o.messages.data[e]=[]),o.messages.data.all.push(t),o.messages.data[e].push(t)}},reset:function(){o.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[]}}},timer:{totalSeconds:0,interval:null,start:function(){if(null===o.timer.interval){o.timer.interval=setInterval((function(){var e;t(".wpstg--modal--process--elapsed-time").text((e=o.timer.totalSeconds,console.log("Process running for "+e+" seconds"),""+new Date(1e3*e).toISOString().substr(11,8))),o.timer.totalSeconds++}),1e3)}},stop:function(){o.timer.totalSeconds=0,o.timer.interval&&(clearInterval(o.timer.interval),o.timer.interval=null)}},upload:{reader:null,file:null,iop:1024e3,uploadInfo:function(e){var a=t(".wpstg--modal--import--upload--process"),o=t(".wpstg--uploader");if(e)return a.css("display","flex"),void o.hide();o.css("display","flex"),a.hide()},start:function(){console.log("file "+o.modal.import.data.file),o.upload.reader=new FileReader,o.upload.file=o.modal.import.file,o.upload.uploadInfo(!0),o.upload.sendChunk()},sendChunk:function(e){if(void 0===e&&(e=0),o.upload.file){var a=e<1,s=e+o.upload.iop+1,n=o.upload.file.slice(e,s);o.upload.reader.onloadend=function(n){if(n.target.readyState===FileReader.DONE){var r=new FormData;r.append("accessToken",wpstg.accessToken),r.append("nonce",wpstg.nonce),r.append("data",n.target.result),r.append("filename",o.upload.file.name),r.append("reset",a?"1":"0"),fetch(ajaxurl+"?action=wpstg--backups--import--file-upload",{method:"POST",body:r}).then(o.handleFetchErrors).then((function(t){return t.json()})).then((function(a){o.showAjaxFatalError(a,"","Submit an error report.");var n=e+o.upload.iop,r=Math.floor(n/o.upload.file.size*100);if(s>=o.upload.file.size)return o.upload.uploadInfo(!1),o.isLoading(!1),void t(".wpstg--modal--actions .swal2-confirm").prop("disabled",!1);t(".wpstg--modal--import--upload--progress--title > span").text(r),t(".wpstg--modal--import--upload--progress").css("width",r+"%"),o.upload.sendChunk(s)})).catch((function(t){return o.showAjaxFatalError(t,"","Submit an error report.")}))}},o.upload.reader.readAsDataURL(n)}}},status:{hasResponse:null,reTryAfter:5e3},fetchListing:function(t){return void 0===t&&(t=!0),o.isLoading(!0),t&&o.resetErrors(),fetch(ajaxurl+"?action=wpstg--backups--database-legacy-listing&_="+Math.random()+"&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce).then(o.handleFetchErrors).then((function(t){return t.json()})).then((function(t){return o.showAjaxFatalError(t,"","Submit an error report."),o.cache.get("#wpstg--tab--database-backups").html(t),o.isLoading(!1),t})).catch((function(t){return o.showAjaxFatalError(t,"","Submit an error report.")}))},delete:function(){t("#wpstg--tab--database-backups").off("click",".wpstg-delete-backup[data-id]").on("click",".wpstg-delete-backup[data-id]",(function(t){t.preventDefault(),o.resetErrors(),o.isLoading(!0),o.cache.get("#wpstg-existing-database-backups").hide();var e=this.getAttribute("data-id");o.ajax({action:"wpstg--backups--database-legacy-delete-confirm",id:e,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){o.showAjaxFatalError(t,""," Please submit an error report by using the REPORT ISSUE button."),o.isLoading(!1),o.cache.get("#wpstg-delete-confirmation").html(t)}))})).off("click","#wpstg-delete-backup").on("click","#wpstg-delete-backup",(function(t){t.preventDefault(),o.resetErrors(),o.isLoading(!0);var e=this.getAttribute("data-id");o.ajax({action:"wpstg--backups--database-legacy-delete",id:e,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){o.showAjaxFatalError(t,""," Please submit an error report by using the REPORT ISSUE button."),o.fetchListing(),o.isLoading(!1)}))})).off("click","#wpstg-cancel-backup-delete").on("click","#wpstg-cancel-backup-delete",(function(t){t.preventDefault(),o.isLoading(!1),o.fetchListing()})),t("#wpstg-error-wrapper").off("click","#wpstg-backup-force-delete").on("click","#wpstg-backup-force-delete",(function(t){t.preventDefault(),o.resetErrors(),o.isLoading(!0);var e=this.getAttribute("data-id");if(!confirm("Do you want to delete this backup "+e+" from the listed backups?"))return o.isLoading(!1),!1;o.ajax({action:"wpstg--backups--database-legacy-delete",id:e,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){o.showAjaxFatalError(t,""," Please submit an error report by using the REPORT ISSUE button."),o.fetchListing(),o.isLoading(!1)}))}))},restore:function(){var e=function e(a,s){o.isLoading(!0),o.resetErrors(),void 0===s&&(s=!1),WPStaging.ajax({action:"wpstg--backups--database-legacy-restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg:{tasks:{backup:{database:{create:{source:a,reset:s}}}}}},(function(s){void 0!==s?(o.processResponse(s),!1===s.status||!1===s.job_done?e(a):!0===s.status&&!0===s.job_done?(o.isLoading(!1),t(".wpstg--modal--process--title").text("Backup successfully restored"),setTimeout((function(){Swal.close(),alert("Backup successfully restored. Please log-in again to WordPress."),o.fetchListing()}),1e3)):setTimeout((function(){e(a)}),wpstg.delayReq)):setTimeout((function(){e(a)}),wpstg.delayReq)}),"json",!1,0,1.25)};t("#wpstg--tab--database-backups").off("click",".wpstg--backup--restore[data-id]").on("click",".wpstg--backup--restore[data-id]",(function(e){e.preventDefault(),o.resetErrors(),o.ajax({action:"wpstg--backups--database-legacy-restore-confirm",accessToken:wpstg.accessToken,nonce:wpstg.nonce,id:t(this).data("id")},(function(t){o.cache.get("#wpstg--tab--database-backups").html(t)}))})).off("click","#wpstg--backup--restore--cancel").on("click","#wpstg--backup--restore--cancel",(function(t){o.resetErrors(),t.preventDefault(),o.fetchListing()})).off("click","#wpstg--backup--restore[data-id]").on("click","#wpstg--backup--restore[data-id]",(function(t){t.preventDefault(),o.resetErrors();var a=this.getAttribute("data-id");o.process({execute:function(){o.messages.reset(),e(a,!0)},isShowCancelButton:!1})}))},edit:function(){t("#wpstg--tab--database-backups").off("click",".wpstg--backup--edit[data-id]").on("click",".wpstg--backup--edit[data-id]",function(){var a=e(regeneratorRuntime.mark((function e(a){var s,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),s=t(this).data("name"),n=t(this).data("notes"),e.next=5,Swal.fire({title:"",html:'\n                    <label id="wpstg-backup-edit-name">Backup Name</label>\n                    <input id="wpstg-backup-edit-name-input" class="swal2-input" value="'+s+'">\n                    <label>Additional Notes</label>\n                    <textarea id="wpstg-backup-edit-notes-textarea" class="swal2-textarea">'+n+"</textarea>\n                  ",focusConfirm:!1,confirmButtonText:"Update Backup",showCancelButton:!0,preConfirm:function(){return{name:document.getElementById("wpstg-backup-edit-name-input").value||null,notes:document.getElementById("wpstg-backup-edit-notes-textarea").value||null}}});case 5:if(r=e.sent,i=r.value){e.next=9;break}return e.abrupt("return");case 9:o.ajax({action:"wpstg--backups--database-legacy-edit",accessToken:wpstg.accessToken,nonce:wpstg.nonce,id:t(this).data("id"),name:i.name,notes:i.notes},(function(t){o.showAjaxFatalError(t,"","Submit an error report."),o.fetchListing()}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return a.apply(this,arguments)}}())},cancel:function(){o.timer.stop(),o.isCancelled=!0,Swal.close(),setTimeout((function(){return o.ajax({action:"wpstg--backups--cancel",accessToken:wpstg.accessToken,nonce:wpstg.nonce,type:o.type},(function(t){o.showAjaxFatalError(t,"","Submit an error report.")}))}),500)},process:function(e){if(!("function"==typeof e.execute||e.data&&e.onResponse))return Swal.close(),void o.showError("process.data and / or process.onResponse is not set");if(!o.modal.process.html||!o.modal.process.cancelBtnTxt){var a=t("#wpstg--modal--backup--process"),s=a.html(),n=a.attr("data-cancelButtonText");o.modal.process.html=s||null,o.modal.process.cancelBtnTxt=n||null,a.remove()}t("body").off("click",".wpstg--modal--process--logs--tail").on("click",".wpstg--modal--process--logs--tail",(function(e){e.preventDefault();var a=Swal.getContainer(),o=t(a).find(".wpstg--modal--process--logs");o.toggle(),o.is(":visible")?(a.childNodes[0].style.width="100%",a.style["z-index"]=9999):a.childNodes[0].style.width="600px"})),e.isShowCancelButton=!1!==e.isShowCancelButton,o.modal.process.modal=Swal.mixin({customClass:{cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",content:"wpstg--process--content"},buttonsStyling:!1}).fire({html:o.modal.process.html,cancelButtonText:o.modal.process.cancelBtnTxt,showCancelButton:e.isShowCancelButton,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,width:600,onRender:function(){var t=Swal.getContainer().getElementsByClassName("swal2-cancel wpstg--btn--cancel")[0],a=t.cloneNode(!0);if(t.parentNode.replaceChild(a,t),a.addEventListener("click",(function(t){confirm("Are You Sure? This will cancel the process!")&&Swal.close()})),"function"!=typeof e.execute)return e.data&&e.onResponse?void o.ajax(e.data,e.onResponse):(Swal.close(),void o.showError("process.data and / or process.onResponse is not set"));e.execute()},onAfterClose:function(){return"function"==typeof e.onAfterClose&&e.onAfterClose()},onClose:function(){console.log("cancelled"),o.cancel()}})},processResponse:function(e,a){if(null===e)throw Swal.close(),o.showError("Invalid Response; null"),new Error("Invalid Response; "+e);var n=t(Swal.getContainer());(e.title||e.statusTitle)&&!0===a&&n.find(".wpstg--modal--process--title").text(e.title||e.statusTitle),e.percentage&&n.find(".wpstg--modal--process--percent").text(e.percentage),function(){if(e.messages){for(var t,a=n.find(".wpstg--modal--process--logs"),r=[o.messages.ERROR,o.messages.CRITICAL],i=function t(e){if(Array.isArray(e))for(var n,i=s(e);!(n=i()).done;){t(n.value)}else{var l="wpstg--modal--process--msg--"+e.type.toLowerCase();a.append('<p class="'+l+'">['+e.type+"] - ["+e.date+"] - "+e.message+"</p>"),r.includes(e.type.toLowerCase())&&(o.cancel(),setTimeout(o.logsModal,500))}},l=s(e.messages);!(t=l()).done;){var c=t.value;c&&(o.messages.addMessage(c),i(c))}if(a.is(":visible")&&a.scrollTop(a[0].scrollHeight),o.messages.shouldWarn()){var p=n.find(".wpstg--modal--process--logs--tail");p.html(p.attr("data-txt-bad")),p.find(".wpstg--modal--logs--critical-count").text(o.messages.countByType(o.messages.CRITICAL)),p.find(".wpstg--modal--logs--error-count").text(o.messages.countByType(o.messages.ERROR)),p.find(".wpstg--modal--logs--warning-count").text(o.messages.countByType(o.messages.WARNING))}}}(),!0===e.status&&!0===e.job_done&&(o.timer.stop(),o.isCancelled=!0)},requestData:function(t,e){var a={},o=t.split("."),s=o.length-1;return o.reduce((function(t,a,o){return t[a]=o>=s?e:{}}),a),a},logsModal:function(){Swal.fire({html:'<div class="wpstg--modal--error--logs" style="display:block"></div><div class="wpstg--modal--process--logs" style="display:block"></div>',width:"95%",onRender:function(){var e=t(Swal.getContainer());e[0].style["z-index"]=9999;var a=e.find(".wpstg--modal--process--logs"),n=e.find(".wpstg--modal--error--logs"),r=t("#wpstg--js--translations"),i=o.messages,l=r.attr("data-modal-logs-title").replace("{critical}",i.countByType(i.CRITICAL)).replace("{errors}",i.countByType(i.ERROR)).replace("{warnings}",i.countByType(i.WARNING));n.before("<h3>"+l+"</h3>");var c=[o.messages.CRITICAL,o.messages.ERROR,o.messages.WARNING];o.messages.shouldWarn()||n.hide();for(var p,u=s(i.data.all);!(p=u()).done;){var d=p.value,g="wpstg--modal--process--msg--"+d.type.toLowerCase();c.includes(d.type)&&n.append('<p class="'+g+'">['+d.type+"] - ["+d.date+"] - "+d.message+"</p>"),a.append('<p class="'+g+'">['+d.type+"] - ["+d.date+"] - "+d.message+"</p>")}},onOpen:function(e){var a=t(e).find(".wpstg--modal--process--logs");a.scrollTop(a[0].scrollHeight)}})},downloadModal:function(e){var a=e.title,s=void 0===a?null:a,n=e.titleExport,r=void 0===n?null:n,i=e.id,l=void 0===i?null:i,c=e.url,p=void 0===c?null:c,u=e.btnTxtCancel,d=void 0===u?"Cancel":u,g=e.btnTxtConfirm,m=void 0===g?"Download":g;if(null===o.modal.download.html){var f=t("#wpstg--modal--backup--download");o.modal.download.html=f.html(),f.remove()}Swal.mixin({customClass:{cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",actions:"wpstg--modal--actions"},buttonsStyling:!1}).fire({icon:"success",html:o.modal.download.html.replace("{title}",s).replace("{btnTxtLog}","Show Logs"),cancelButtonText:d,confirmButtonText:m,showCancelButton:!0,showConfirmButton:!0}).then((function(t){t&&t.value&&(p&&p.length>0?window.location.href=p:Swal.fire({html:"<h2>"+r+'</h2><span class="wpstg-loader"></span>',showCancelButton:!1,showConfirmButton:!1,onRender:function(){o.ajax({action:"wpstg--backups--database-legacy-export",accessToken:wpstg.accessToken,nonce:wpstg.nonce,id:l},(function(t){if(console.log(t),t&&t.success&&t.data&&!(t.data.length<1)){var e=document.createElement("a");e.style.display="none",e.href=t.data,document.body.appendChild(e),e.click(),document.body.removeChild(e),Swal.close()}}))}}))}))},importModal:function(){var e=function e(s){if(o.resetErrors(),o.isCancelled)console.log("cancelled");else{var n=s.reset;delete s.reset,s.mergeMediaFiles=1;var r=Object.assign({},s);r=o.requestData("jobs.backup.site.restore",a({},o.modal.import.data)),o.timer.start();var i=function(){console.log("Status: Stop"),clearInterval(o.processInfo.interval),o.processInfo.interval=null};WPStaging.ajax({action:"wpstg--backups--database-legacy-restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,reset:n,wpstg:r},(function(a){if(void 0!==a)if(o.processResponse(a,!0),o.processInfo.interval||null===o.processInfo.interval&&(console.log("Status: Start"),o.processInfo.interval=setInterval((function(){!0!==o.isCancelled?!1!==o.status.hasResponse&&(o.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&process=restore&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce).then((function(t){return t.json()})).then((function(e){if(o.status.hasResponse=!0,void 0===e&&i(),o.processInfo.title!==e.currentStatusTitle){o.processInfo.title=e.currentStatusTitle;var a=t(Swal.getContainer());a.find(".wpstg--modal--process--title").text(e.currentStatusTitle),a.find(".wpstg--modal--process--percent").text("0")}})).catch((function(t){o.status.hasResponse=!0,o.showAjaxFatalError(t,"","Submit an error report.")}))):i()}),5e3)),!1===a.status)e(s);else if(!0===a.status){if(t("#wpstg--progress--status").text("Backup successfully restored!"),o.type=null,o.messages.shouldWarn())return o.fetchListing(),void o.logsModal();i();var n='<div class="wpstg--modal--process--logs">'+t(".wpstg--modal--process--logs").get(1).innerHTML+"</div>",r=n.includes("wpstg--modal--process--msg--warning")||n.includes("wpstg--modal--process--msg--error")?"Issues(s) found! ":"";console.log("errors found: "+r),Swal.fire({icon:"success",title:"Finished",html:'System restored from backup. <br/><span class="wpstg--modal--process--msg-found">'+r+'</span><button class="wpstg--modal--process--logs--tail" data-txt-bad="">Show Logs</button><br/>'+n}),o.fetchListing()}else setTimeout((function(){e(s)}),wpstg.delayReq);else setTimeout((function(){e(s)}),wpstg.delayReq)}),"json",!1,0,1.25)}};if(!o.modal.import.html){var s=t("#wpstg--modal--backup--import"),n=s.find(".wpstg--modal--backup--import--search-replace--input--container");o.modal.import.searchReplaceForm=n.html(),n.find(".wpstg--modal--backup--import--search-replace--input-group").remove(),n.html(o.modal.import.searchReplaceForm.replace(/{i}/g,0)),o.modal.import.html=s.html(),o.modal.import.baseDirectory=s.attr("data-baseDirectory"),o.modal.import.btnTxtNext=s.attr("data-nextButtonText"),o.modal.import.btnTxtConfirm=s.attr("data-confirmButtonText"),o.modal.import.btnTxtCancel=s.attr("data-cancelButtonText"),s.remove()}o.modal.import.data.search=[],o.modal.import.data.replace=[];Swal.mixin({customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions"},buttonsStyling:!1}).queue([{html:o.modal.import.html,confirmButtonText:o.modal.import.btnTxtNext,showCancelButton:!1,showConfirmButton:!0,showLoaderOnConfirm:!0,width:650,onRender:function(){t(".wpstg--modal--actions .swal2-confirm").prop("disabled",!0),o.modal.import.containerUpload=t(".wpstg--modal--backup--import--upload"),o.modal.import.containerFilesystem=t(".wpstg--modal--backup--import--filesystem")},preConfirm:function(){var t=new FormData;return t.append("accessToken",wpstg.accessToken),t.append("nonce",wpstg.nonce),t.append("filePath",o.modal.import.data.file),o.modal.import.data.search.forEach((function(e,a){t.append("search["+a+"]",e)})),o.modal.import.data.replace.forEach((function(e,a){t.append("replace["+a+"]",e)})),fetch(ajaxurl+"?action=wpstg--backups--import--file-info",{method:"POST",body:t}).then(o.handleFetchErrors).then((function(t){return t.json()})).then((function(t){return Swal.insertQueueStep({html:t,confirmButtonText:o.modal.import.btnTxtConfirm,cancelButtonText:o.modal.import.btnTxtCancel,showCancelButton:!0})})).catch((function(t){return o.showAjaxFatalError(t,"","Submit an error report.")}))}}]).then((function(t){if(t&&t.value&&t.value[1]&&!0===t.value[1]){o.isCancelled=!1;var a=o.modal.import.data;a.file=o.modal.import.baseDirectory+a.file,a.reset=!0,o.process({execute:function(){o.messages.reset(),e(a)}})}}))}}}(jQuery)}();
//# sourceMappingURL=wpstg-legacy-database.min.js.map
