{"version":3,"file":"wpstg-legacy-database.min.js","sources":["../src/wpstg-legacy-database.js"],"sourcesContent":["(function($) {\n  window.addEventListener('database-backups-tab', function() {\n    WPStagingLegacyDatabase.init();\n  });\n\n  const WPStagingLegacyDatabase = {\n    type: null,\n    isCancelled: false,\n    processInfo: {\n      title: null,\n      interval: null,\n    },\n    cache: {\n      elements: [],\n      get: function(selector) {\n      // It is already cached!\n        if ($.inArray(selector, this.elements) !== -1) {\n          return this.elements[selector];\n        }\n\n        // Create cache and return\n        this.elements[selector] = $(selector);\n\n        return this.elements[selector];\n      },\n      refresh: function(selector) {\n        selector.elements[selector] = $(selector);\n      },\n    },\n    init() {\n      WPStagingLegacyDatabase.fetchListing();\n      this.create();\n      this.delete();\n      this.restore();\n      this.edit();\n\n      // noinspection JSIgnoredPromiseFromCall\n\n\n      $('body')\n          .off('change', '#wpstg--backups--filter')\n          .on('change', '#wpstg--backups--filter', function() {\n            const $records = $('#wpstg-existing-database-backups').find('> div[id][data-type].wpstg-backup');\n            if (this.value === '') {\n              $records.show();\n            } else if (this.value === 'database') {\n              $records.filter('[data-type=\"site\"]').hide();\n              $records.filter('[data-type=\"database\"]').show();\n            } else if (this.value === 'site') {\n              $records.filter('[data-type=\"database\"]').hide();\n              $records.filter('[data-type=\"site\"]').show();\n            }\n          })\n          .on('click', '.wpstg--backup--download', function() {\n            const url = this.getAttribute('data-url');\n            if (url.length > 0) {\n              window.location.href = url;\n              return;\n            }\n            WPStagingLegacyDatabase.downloadModal({\n              titleExport: this.getAttribute('data-title-export'),\n              title: this.getAttribute('data-title'),\n              id: this.getAttribute('data-id'),\n              btnTxtCancel: this.getAttribute('data-btn-cancel-txt'),\n              btnTxtConfirm: this.getAttribute('data-btn-download-txt'),\n            });\n          })\n          .off('click', '#wpstg-import-backup')\n          .on('click', '#wpstg-import-backup', function() {\n            WPStagingLegacyDatabase.importModal();\n          })\n      // Import\n          .off('click', '.wpstg--backup--import--choose-option')\n          .on('click', '.wpstg--backup--import--choose-option', function() {\n            const $parent = $(this).parent();\n            if (!$parent.hasClass('wpstg--show-options')) {\n              $parent.addClass('wpstg--show-options');\n              $(this).text($(this).attr('data-txtChoose'));\n            } else {\n              $parent.removeClass('wpstg--show-options');\n              $(this).text($(this).attr('data-txtOther'));\n            }\n          })\n          .off('click', '.wpstg--modal--backup--import--search-replace--new')\n          .on('click', '.wpstg--modal--backup--import--search-replace--new', function(e) {\n            e.preventDefault();\n            const $container = $(Swal.getContainer()).find('.wpstg--modal--backup--import--search-replace--input--container');\n            const total = $container.find('.wpstg--modal--backup--import--search-replace--input-group').length;\n            $container.append(WPStagingLegacyDatabase.modal.import.searchReplaceForm.replace(/{i}/g, total));\n          })\n          .off('input', '.wpstg--backup--import--search')\n          .on('input', '.wpstg--backup--import--search', function() {\n            const index = parseInt(this.getAttribute('data-index'));\n            if (!isNaN(index)) {\n              WPStagingLegacyDatabase.modal.import.data.search[index] = this.value;\n            }\n          })\n          .off('input', '.wpstg--backup--import--replace')\n          .on('input', '.wpstg--backup--import--replace', function() {\n            const index = parseInt(this.getAttribute('data-index'));\n            if (!isNaN(index)) {\n              WPStagingLegacyDatabase.modal.import.data.replace[index] = this.value;\n            }\n          })\n      // Other Options\n          .off('click', '.wpstg--backup--import--option[data-option]')\n          .on('click', '.wpstg--backup--import--option[data-option]', function() {\n            const option = this.getAttribute('data-option');\n\n            if (option === 'file') {\n              $('input[type=\"file\"][name=\"wpstg--backup--import--upload--file\"]').click();\n              return;\n            }\n\n            if (option === 'upload') {\n              WPStagingLegacyDatabase.modal.import.containerFilesystem.hide();\n              WPStagingLegacyDatabase.modal.import.containerUpload.show();\n              $('.wpstg--backup--import--choose-option').click();\n              $('.wpstg--modal--backup--import--search-replace--wrapper').show();\n            }\n\n            if (option !== 'filesystem') {\n              return;\n            }\n\n            WPStagingLegacyDatabase.modal.import.containerUpload.hide();\n            const $containerFilesystem = WPStagingLegacyDatabase.modal.import.containerFilesystem;\n            $containerFilesystem.show();\n\n            fetch(`${ajaxurl}?action=wpstg--backups--import--file-list&_=${Math.random()}&accessToken=${wpstg.accessToken}&nonce=${wpstg.nonce}`)\n                .then(WPStagingLegacyDatabase.handleFetchErrors)\n                .then((res) => res.json())\n                .then((res) => {\n                  const $ul = $('.wpstg--modal--backup--import--filesystem ul');\n                  $ul.empty();\n\n                  if (!res || WPStagingLegacyDatabase.isEmpty(res)) {\n                    $ul.append(`<span id=\"wpstg--backups--import--file-list-empty\">No import file found! Upload an import file to the folder above.</span><br />`);\n                    $('.wpstg--modal--backup--import--search-replace--wrapper').hide();\n                    return;\n                  }\n\n                  $ul.append(`<span id=\"wpstg--backups--import--file-list\">Select file to import:</span><br />`);\n                  res.forEach(function(file, index) {\n                  // var checked = (index === 0) ? 'checked' : '';\n                    $ul.append(`<li><label><input name=\"backup_import_file\" type=\"radio\" value=\"${file.fullPath}\">${file.name} <br /> ${file.size}</label></li>`);\n                  });\n                  // $('.wpstg--modal--actions .swal2-confirm').prop('disabled', false);\n                  return res;\n                })\n                .catch((e) => WPStagingLegacyDatabase.showAjaxFatalError(e, '', 'Submit an error report.'))\n            ;\n          })\n          .off('change', 'input[type=\"file\"][name=\"wpstg--backup--import--upload--file\"]')\n          .on('change', 'input[type=\"file\"][name=\"wpstg--backup--import--upload--file\"]', function() {\n            WPStagingLegacyDatabase.modal.import.setFile(this.files[0] || null);\n            $('.wpstg--backup--import--choose-option').click();\n          })\n          .off('change', 'input[type=\"radio\"][name=\"backup_import_file\"]')\n          .on('change', 'input[type=\"radio\"][name=\"backup_import_file\"]', function() {\n            $('.wpstg--modal--actions .swal2-confirm').prop('disabled', false);\n            WPStagingLegacyDatabase.modal.import.data.file = this.value;\n          })\n      // Drag & Drop\n          .on('drag dragstart dragend dragover dragenter dragleave drop', '.wpstg--modal--backup--import--upload--container', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n          })\n          .on('dragover dragenter', '.wpstg--modal--backup--import--upload--container', function() {\n            $(this).addClass('wpstg--has-dragover');\n          })\n          .on('dragleave dragend drop', '.wpstg--modal--backup--import--upload--container', function() {\n            $(this).removeClass('wpstg--has-dragover');\n          })\n          .on('drop', '.wpstg--modal--backup--import--upload--container', function(e) {\n            WPStagingLegacyDatabase.modal.import.setFile(e.originalEvent.dataTransfer.files[0] || null);\n          })\n      ;\n    },\n    create() {\n      var createBackup = function(data) {\n        WPStagingLegacyDatabase.resetErrors();\n\n        if (WPStagingLegacyDatabase.isCancelled) {\n        // Swal.close();\n          return;\n        }\n\n        const reset = data['reset'];\n        delete data['reset'];\n        let requestData = Object.assign({}, data);\n        let useResponseTitle = true;\n\n        if (data.type === 'database') {\n          WPStagingLegacyDatabase.type = data.type;\n\n          // Only send to back-end what BE is expecting to receive.\n          // Prevent error: Trying to hydrate DTO with value that does not exist.\n          delete requestData['includedDirectories'];\n          delete requestData['wpContentDir'];\n          delete requestData['availableDirectories'];\n          delete requestData['wpStagingDir'];\n          delete requestData['exportDatabase'];\n          delete requestData['includeOtherFilesInWpContent'];\n\n          requestData = WPStagingLegacyDatabase.requestData(\n              'tasks.backup.database.create',\n              {...requestData, type: 'manual'},\n          );\n        } else if (data.type === 'site') {\n          WPStagingLegacyDatabase.type = data.type;\n\n          // Only send to back-end what BE is expecting to receive.\n          // Prevent error: Trying to hydrate DTO with value that does not exist.\n          delete requestData['type'];\n\n          requestData = WPStagingLegacyDatabase.requestData(\n              'jobs.backup.site.create',\n              requestData,\n          );\n          useResponseTitle = false;\n          requestData.jobs.backup.site.create.directories = [\n            data.wpContentDir,\n          ];\n          requestData.jobs.backup.site.create.excludedDirectories = data.availableDirectories\n              .split('|')\n              .filter((item) => !data.includedDirectories.includes(item))\n              .map((item) => item)\n          ;\n          requestData.jobs.backup.site.create.includeOtherFilesInWpContent = [\n            data.includeOtherFilesInWpContent,\n          ];\n\n          // Do not exclude the wp-content/uploads/wp-staging using regex by default\n          // This folder is excluded by PHP without REGEX.\n          // requestData.jobs.backup.site.create.excludedDirectories.push(`#${data.wpStagingDir}*#`);\n\n          // delete requestData.jobs.backup.site.create.includedDirectories;\n          delete requestData.jobs.backup.site.create.wpContentDir;\n          delete requestData.jobs.backup.site.create.wpStagingDir;\n          delete requestData.jobs.backup.site.create.availableDirectories;\n        } else {\n          WPStagingLegacyDatabase.type = null;\n          Swal.close();\n          WPStagingLegacyDatabase.showError('Invalid Backup Type');\n          return;\n        }\n\n        WPStagingLegacyDatabase.timer.start();\n\n        const statusStop = () => {\n          console.log('Status: Stop');\n          clearInterval(WPStagingLegacyDatabase.processInfo.interval);\n          WPStagingLegacyDatabase.processInfo.interval = null;\n        };\n        const status = () => {\n          if (WPStagingLegacyDatabase.processInfo.interval !== null) {\n            return;\n          }\n          console.log('Status: Start');\n          WPStagingLegacyDatabase.processInfo.interval = setInterval(() => {\n            if (true === WPStagingLegacyDatabase.isCancelled) {\n              statusStop();\n              return;\n            }\n\n            if (WPStagingLegacyDatabase.status.hasResponse === false) {\n              return;\n            }\n\n            WPStagingLegacyDatabase.status.hasResponse = false;\n            fetch(`${ajaxurl}?action=wpstg--backups--status&accessToken=${wpstg.accessToken}&nonce=${wpstg.nonce}`)\n                .then((res) => res.json())\n                .then((res) => {\n                  WPStagingLegacyDatabase.status.hasResponse = true;\n                  if (typeof res === 'undefined') {\n                    statusStop();\n                  }\n\n                  if (WPStagingLegacyDatabase.processInfo.title === res.currentStatusTitle) {\n                    return;\n                  }\n\n                  WPStagingLegacyDatabase.processInfo.title = res.currentStatusTitle;\n                  const $container = $(Swal.getContainer());\n                  $container.find('.wpstg--modal--process--title').text(res.currentStatusTitle);\n                  $container.find('.wpstg--modal--process--percent').text('0');\n                })\n                .catch((e) => {\n                  WPStagingLegacyDatabase.status.hasResponse = true;\n                  WPStagingLegacyDatabase.showAjaxFatalError(e, '', 'Submit an error report.');\n                })\n            ;\n          }, 5000);\n        };\n\n        WPStaging.ajax(\n            {\n              action: 'wpstg--backups--database-legacy-create',\n              accessToken: wpstg.accessToken,\n              nonce: wpstg.nonce,\n              reset,\n              wpstg: requestData,\n            },\n            function(response) {\n              if (typeof response === 'undefined') {\n                setTimeout(function() {\n                  createBackup(data);\n                }, wpstg.delayReq);\n                return;\n              }\n\n              WPStagingLegacyDatabase.processResponse(response, useResponseTitle);\n              if (!useResponseTitle && !WPStagingLegacyDatabase.processInfo.interval) {\n                status();\n              }\n\n              if (response.status === false) {\n                createBackup(data);\n              } else if (response.status === true) {\n                $('#wpstg--progress--status').text('Backup successfully created!');\n                WPStagingLegacyDatabase.type = null;\n                if (WPStagingLegacyDatabase.messages.shouldWarn()) {\n                  // noinspection JSIgnoredPromiseFromCall\n                  WPStagingLegacyDatabase.fetchListing();\n                  WPStagingLegacyDatabase.logsModal();\n                  return;\n                }\n                statusStop();\n                Swal.close();\n                WPStagingLegacyDatabase.fetchListing()\n                    .then(() => {\n                      if (!response.backupId) {\n                        WPStagingLegacyDatabase.showError('Failed to get backup ID from response');\n                        return;\n                      }\n\n                      // TODO RPoC\n                      const $el = $(`.wpstg--backup--download[data-id=\"${response.backupId}\"]`);\n                      WPStagingLegacyDatabase.downloadModal({\n                        id: $el.data('id'),\n                        url: $el.data('url'),\n                        title: $el.data('title'),\n                        titleExport: $el.data('title-export'),\n                        btnTxtCancel: $el.data('btn-cancel-txt'),\n                        btnTxtConfirm: $el.data('btn-download-txt'),\n                      });\n                      $('.wpstg--modal--download--logs--wrapper').show();\n                      const $logsContainer = $('.wpstg--modal--process--logs');\n                      WPStagingLegacyDatabase.messages.data.all.forEach((message) => {\n                        const msgClass = `wpstg--modal--process--msg--${message.type.toLowerCase()}`;\n                        $logsContainer\n                            .append(`<p class=\"${msgClass}\">[${message.type}] - [${message.date}] - ${message.message}</p>`)\n                        ;\n                      });\n                    })\n                ;\n              } else {\n                setTimeout(function() {\n                  createBackup(data);\n                }, wpstg.delayReq);\n              }\n            },\n            'json',\n            false,\n            0, // Don't retry upon failure\n            1.25,\n        );\n      };\n\n      const $body = $('body');\n\n      $body\n          .off('click', 'input[name=\"backup_type\"]')\n          .on('click', 'input[name=\"backup_type\"]', function() {\n            const advancedOptions = $('.wpstg-advanced-options');\n            if (this.value === 'database') {\n              advancedOptions.hide();\n              return;\n            }\n            advancedOptions.show();\n          })\n          .off('click', '.wpstg--tab--toggle')\n          .on('click', '.wpstg--tab--toggle', function() {\n            const $target = $($(this).attr('data-target'));\n            $target.toggle();\n            if ($target.is(':visible')) {\n              $(this).find('span').text('▼');\n            } else {\n              $(this).find('span').text('►');\n            }\n          })\n          .off('change', '[name=\"includedDirectories\\[\\]\"], [type=\"checkbox\"][name=\"export_database\"]')\n          .on('change', '[type=\"checkbox\"][name=\"includedDirectories\\[\\]\"], [type=\"checkbox\"][name=\"export_database\"]', function() {\n            const totalDirs = $('[type=\"checkbox\"][name=\"includedDirectories\\[\\]\"]:checked').length;\n            const isExportDatabase = $('[type=\"checkbox\"][name=\"export_database\"]:checked').length === 1;\n            if (totalDirs < 1 && !isExportDatabase) {\n              $('.swal2-confirm').prop('disabled', true);\n            } else {\n              $('.swal2-confirm').prop('disabled', false);\n            }\n          })\n      ;\n\n      // Add backup name and notes\n      $('#wpstg--tab--database-backups')\n          .off('click', '#wpstg-new-database-backup')\n          .on('click', '#wpstg-new-database-backup', async function(e) {\n            WPStagingLegacyDatabase.resetErrors();\n            e.preventDefault();\n            WPStagingLegacyDatabase.isCancelled = false;\n\n            if (!WPStagingLegacyDatabase.modal.create.html || !WPStagingLegacyDatabase.modal.create.confirmBtnTxt) {\n              const $newBackupModal = $('#wpstg--modal--database--new');\n              const html = $newBackupModal.html();\n              const btnTxt = $newBackupModal.attr('data-confirmButtonText');\n              WPStagingLegacyDatabase.modal.create.html = html || null;\n              WPStagingLegacyDatabase.modal.create.confirmBtnTxt = btnTxt || null;\n              $newBackupModal.remove();\n            }\n\n            const {value: formValues} = await Swal.fire({\n              title: '',\n              html: WPStagingLegacyDatabase.modal.create.html,\n              focusConfirm: false,\n              confirmButtonText: WPStagingLegacyDatabase.modal.create.confirmBtnTxt,\n              showCancelButton: true,\n              preConfirm: () => {\n                const container = Swal.getContainer();\n\n                return {\n                  type: 'database',\n                  name: container.querySelector('input[name=\"backup_name\"]').value || null,\n                  notes: container.querySelector('textarea[name=\"backup_note\"]').value || null,\n                  includedDirectories: Array.from((container.querySelectorAll('input[name=\"includedDirectories\\\\[\\\\]\"]:checked') || [])).map((i) => i.value),\n                  wpContentDir: container.querySelector('input[name=\"wpContentDir\"]').value || null,\n                  availableDirectories: container.querySelector('input[name=\"availableDirectories\"]').value || null,\n                  wpStagingDir: container.querySelector('input[name=\"wpStagingDir\"]').value || null,\n                  exportDatabase: container.querySelector('input[name=\"export_database\"]:checked') !== null,\n                  includeOtherFilesInWpContent: container.querySelector('input[name=\"includeOtherFilesInWpContent\"]:checked') !== null,\n                };\n              },\n            });\n\n            if (!formValues) {\n              return;\n            }\n\n            formValues.reset = true;\n\n            WPStagingLegacyDatabase.process({\n              execute: () => {\n                WPStagingLegacyDatabase.messages.reset();\n                createBackup(formValues);\n              },\n            });\n          })\n      ;\n    },\n    isEmpty: function(obj) {\n      for (const prop in obj) {\n        if (obj.hasOwnProperty(prop)) {\n          return false;\n        }\n      }\n\n      return true;\n    },\n    isLoading: function(isLoading) {\n      if (!isLoading || isLoading === false) {\n        WPStagingLegacyDatabase.cache.get('.wpstg-loader').hide();\n      } else {\n        WPStagingLegacyDatabase.cache.get('.wpstg-loader').show();\n      }\n    },\n    showAjaxFatalError: function(response, prependMessage, appendMessage) {\n      prependMessage = prependMessage ? prependMessage + '<br/><br/>' : 'Something went wrong! <br/><br/>';\n      appendMessage = appendMessage ? appendMessage + '<br/><br/>' : '<br/><br/>Please try the <a href=\\'https://wp-staging.com/docs/wp-staging-settings-for-small-servers/\\' target=\\'_blank\\'>WP Staging Small Server Settings</a> or submit an error report and contact us.';\n\n      if (response === false) {\n        WPStagingLegacyDatabase.showError(prependMessage + ' Error: No response.' + appendMessage);\n        window.removeEventListener('beforeunload', WPStaging.warnIfClosingDuringProcess);\n        return;\n      }\n\n      if (typeof response.error !== 'undefined' && response.error) {\n        console.error(response.message);\n        WPStagingLegacyDatabase.showError(prependMessage + ' Error: ' + response.message + appendMessage);\n        window.removeEventListener('beforeunload', WPStaging.warnIfClosingDuringProcess);\n        return;\n      }\n    },\n    handleFetchErrors: function(response) {\n      if (!response.ok) {\n        WPStagingLegacyDatabase.showError('Error: ' + response.status + ' - ' + response.statusText + '. Please try again or contact support.');\n      }\n      return response;\n    },\n    showError: function(message) {\n      WPStagingLegacyDatabase.cache.get('#wpstg-try-again').css('display', 'inline-block');\n      WPStagingLegacyDatabase.cache.get('#wpstg-cancel-cloning').text('Reset');\n      WPStagingLegacyDatabase.cache.get('#wpstg-resume-cloning').show();\n      WPStagingLegacyDatabase.cache.get('#wpstg-error-wrapper').show();\n      WPStagingLegacyDatabase.cache.get('#wpstg-error-details').show().html(message);\n      WPStagingLegacyDatabase.cache.get('#wpstg-removing-clone').removeClass('loading');\n      WPStagingLegacyDatabase.cache.get('.wpstg-loader').hide();\n      $('.wpstg--modal--process--generic-problem').show().html(message);\n    },\n    resetErrors: function() {\n      WPStagingLegacyDatabase.cache.get('#wpstg-error-details').hide().html('');\n    },\n    /**\n   * Ajax Requests\n   * @param {Object} data\n   * @param {Function} callback\n   * @param {string} dataType\n   * @param {bool} showErrors\n   * @param {int} tryCount\n   * @param {float} incrementRatio\n   */\n    ajax: function(data, callback, dataType, showErrors, tryCount, incrementRatio = null) {\n      if ('undefined' === typeof (dataType)) {\n        dataType = 'json';\n      }\n\n      if (false !== showErrors) {\n        showErrors = true;\n      }\n\n      tryCount = 'undefined' === typeof (tryCount) ? 0 : tryCount;\n\n      const retryLimit = 10;\n\n      let retryTimeout = 10000 * tryCount;\n\n      incrementRatio = parseInt(incrementRatio);\n      if (!isNaN(incrementRatio)) {\n        retryTimeout *= incrementRatio;\n      }\n\n      $.ajax({\n        url: ajaxurl + '?action=wpstg_processing&_=' + (Date.now() / 1000),\n        type: 'POST',\n        dataType: dataType,\n        cache: false,\n        data: data,\n        error: function(xhr, textStatus, errorThrown) {\n          console.log(xhr.status + ' ' + xhr.statusText + '---' + textStatus);\n\n          // try again after 10 seconds\n          tryCount++;\n          if (tryCount <= retryLimit) {\n            setTimeout(function() {\n              WPStagingLegacyDatabase.ajax(data, callback, dataType, showErrors, tryCount, incrementRatio);\n              return;\n            }, retryTimeout);\n          } else {\n            const errorCode = 'undefined' === typeof (xhr.status) ? 'Unknown' : xhr.status;\n            WPStagingLegacyDatabase.showError(\n                'Fatal Error:  ' + errorCode + ' Please try the <a href=\\'https://wp-staging.com/docs/wp-staging-settings-for-small-servers/\\' target=\\'_blank\\'>WP Staging Small Server Settings</a> or submit an error report and contact us.',\n            );\n          }\n        },\n        success: function(data) {\n          if ('function' === typeof (callback)) {\n            callback(data);\n          }\n        },\n        statusCode: {\n          404: function() {\n            if (tryCount >= retryLimit) {\n              WPStagingLegacyDatabase.showError('Error 404 - Can\\'t find ajax request URL! Please try the <a href=\\'https://wp-staging.com/docs/wp-staging-settings-for-small-servers/\\' target=\\'_blank\\'>WP Staging Small Server Settings</a> or submit an error report and contact us.');\n            }\n          },\n          500: function() {\n            if (tryCount >= retryLimit) {\n              WPStagingLegacyDatabase.showError('Fatal Error 500 - Internal server error while processing the request! Please try the <a href=\\'https://wp-staging.com/docs/wp-staging-settings-for-small-servers/\\' target=\\'_blank\\'>WP Staging Small Server Settings</a> or submit an error report and contact us.');\n            }\n          },\n          504: function() {\n            if (tryCount > retryLimit) {\n              WPStagingLegacyDatabase.showError('Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href=\\'https://wp-staging.com/docs/wp-staging-settings-for-small-servers/\\' target=\\'_blank\\'>WP Staging Small Server Settings</a> or submit an error report and contact us.\\n\\ ');\n            }\n          },\n          502: function() {\n            if (tryCount >= retryLimit) {\n              WPStagingLegacyDatabase.showError('Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href=\\'https://wp-staging.com/docs/wp-staging-settings-for-small-servers/\\' target=\\'_blank\\'>WP Staging Small Server Settings</a> or submit an error report and contact us.\\n\\ ');\n            }\n          },\n          503: function() {\n            if (tryCount >= retryLimit) {\n              WPStagingLegacyDatabase.showError('Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href=\\'https://wp-staging.com/docs/wp-staging-settings-for-small-servers/\\' target=\\'_blank\\'>WP Staging Small Server Settings</a> or submit an error report and contact us.\\n\\ ');\n            }\n          },\n          429: function() {\n            if (tryCount >= retryLimit) {\n              WPStagingLegacyDatabase.showError('Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href=\\'https://wp-staging.com/docs/wp-staging-settings-for-small-servers/\\' target=\\'_blank\\'>WP Staging Small Server Settings</a> or submit an error report and contact us.\\n\\ ');\n            }\n          },\n          403: function() {\n            if (tryCount >= retryLimit) {\n              WPStagingLegacyDatabase.showError('Refresh page or login again! The process should be finished successfully. \\n\\ ');\n            }\n          },\n        },\n      });\n    },\n    modal: {\n      create: {\n        html: null,\n        confirmBtnTxt: null,\n      },\n      process: {\n        html: null,\n        cancelBtnTxt: null,\n        modal: null,\n      },\n      download: {\n        html: null,\n      },\n      import: {\n        html: null,\n        btnTxtNext: null,\n        btnTxtConfirm: null,\n        btnTxtCancel: null,\n        searchReplaceForm: null,\n        file: null,\n        containerUpload: null,\n        containerFilesystem: null,\n        setFile: (file, upload = true) => {\n          const toUnit = (bytes) => {\n            const i = Math.floor(Math.log(bytes) / Math.log(1024));\n            return (bytes / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];\n          };\n\n          if (!file) {\n            return;\n          }\n\n          WPStagingLegacyDatabase.modal.import.file = file;\n          WPStagingLegacyDatabase.modal.import.data.file = file.name;\n          console.log(`File ${file.name}`);\n          $('.wpstg--backup--import--selected-file').html(`${file.name} <br /> (${toUnit(file.size)})`).show();\n          $('.wpstg--drag').hide();\n          $('.wpstg--drag-or-upload').show();\n\n          if (upload) {\n            $('.wpstg--modal--actions .swal2-confirm').prop('disabled', true);\n            WPStagingLegacyDatabase.upload.start();\n          }\n        },\n        baseDirectory: null,\n        data: {\n          file: null,\n          search: [],\n          replace: [],\n        },\n      },\n    },\n    messages: {\n      WARNING: 'warning',\n      ERROR: 'error',\n      INFO: 'info',\n      DEBUG: 'debug',\n      CRITICAL: 'critical',\n      data: {\n        all: [], // TODO RPoC\n        info: [],\n        error: [],\n        critical: [],\n        warning: [],\n        debug: [],\n      },\n      shouldWarn() {\n        return WPStagingLegacyDatabase.messages.data.error.length > 0 ||\n        WPStagingLegacyDatabase.messages.data.critical.length > 0\n        ;\n      },\n      countByType(type = WPStagingLegacyDatabase.messages.ERROR) {\n        return WPStagingLegacyDatabase.messages.data[type].length;\n      },\n      addMessage(message) {\n        if (Array.isArray(message)) {\n          message.forEach((item) => {\n            WPStagingLegacyDatabase.messages.addMessage(item);\n          });\n          return;\n        }\n        const type = message.type.toLowerCase() || 'info';\n        if (!WPStagingLegacyDatabase.messages.data[type]) {\n          WPStagingLegacyDatabase.messages.data[type] = [];\n        }\n        WPStagingLegacyDatabase.messages.data.all.push(message); // TODO RPoC\n        WPStagingLegacyDatabase.messages.data[type].push(message);\n      },\n      reset() {\n        WPStagingLegacyDatabase.messages.data = {\n          all: [],\n          info: [],\n          error: [],\n          critical: [],\n          warning: [],\n          debug: [],\n        };\n      },\n    },\n    timer: {\n      totalSeconds: 0,\n      interval: null,\n      start() {\n        if (null !== WPStagingLegacyDatabase.timer.interval) {\n          return;\n        }\n\n        const prettify = (seconds) => {\n          console.log(`Process running for ${seconds} seconds`);\n          // If potentially anything can exceed 24h execution time than that;\n          // const _seconds = parseInt(seconds, 10)\n          // const hours = Math.floor(_seconds / 3600)\n          // const minutes = Math.floor(_seconds / 60) % 60\n          // seconds = _seconds % 60\n          //\n          // return [hours, minutes, seconds]\n          //   .map(v => v < 10 ? '0' + v : v)\n          //   .filter((v,i) => v !== '00' || i > 0)\n          //   .join(':')\n          // ;\n          // Are we sure we won't create anything that exceeds 24h execution time? If not then this;\n          return `${(new Date(seconds * 1000)).toISOString().substr(11, 8)}`;\n        };\n\n        WPStagingLegacyDatabase.timer.interval = setInterval(() => {\n          $('.wpstg--modal--process--elapsed-time').text(prettify(WPStagingLegacyDatabase.timer.totalSeconds));\n          WPStagingLegacyDatabase.timer.totalSeconds++;\n        }, 1000);\n      },\n      stop() {\n        WPStagingLegacyDatabase.timer.totalSeconds = 0;\n        if (WPStagingLegacyDatabase.timer.interval) {\n          clearInterval(WPStagingLegacyDatabase.timer.interval);\n          WPStagingLegacyDatabase.timer.interval = null;\n        }\n      },\n    },\n    upload: {\n      reader: null,\n      file: null,\n      iop: 1000 * 1024,\n      uploadInfo(isShow) {\n        const $containerUpload = $('.wpstg--modal--import--upload--process');\n        const $containerUploader = $('.wpstg--uploader');\n        if (isShow) {\n          $containerUpload.css('display', 'flex');\n          $containerUploader.hide();\n          return;\n        }\n\n        $containerUploader.css('display', 'flex');\n        $containerUpload.hide();\n      },\n      start() {\n        console.log(`file ${WPStagingLegacyDatabase.modal.import.data.file}`);\n        WPStagingLegacyDatabase.upload.reader = new FileReader();\n        WPStagingLegacyDatabase.upload.file = WPStagingLegacyDatabase.modal.import.file;\n        WPStagingLegacyDatabase.upload.uploadInfo(true);\n        WPStagingLegacyDatabase.upload.sendChunk();\n      },\n      sendChunk(startsAt = 0) {\n        if (!WPStagingLegacyDatabase.upload.file) {\n          return;\n        }\n        const isReset = startsAt < 1;\n        const endsAt = startsAt + WPStagingLegacyDatabase.upload.iop + 1;\n        const blob = WPStagingLegacyDatabase.upload.file.slice(startsAt, endsAt);\n        WPStagingLegacyDatabase.upload.reader.onloadend = function(event) {\n          if (event.target.readyState !== FileReader.DONE) {\n            return;\n          }\n\n          const body = new FormData();\n          body.append('accessToken', wpstg.accessToken);\n          body.append('nonce', wpstg.nonce);\n          body.append('data', event.target.result);\n          body.append('filename', WPStagingLegacyDatabase.upload.file.name);\n          body.append('reset', isReset ? '1' : '0');\n\n\n          fetch(`${ajaxurl}?action=wpstg--backups--import--file-upload`, {\n            method: 'POST',\n            body,\n          }).then(WPStagingLegacyDatabase.handleFetchErrors)\n              .then((res) => res.json())\n              .then((res) => {\n                WPStagingLegacyDatabase.showAjaxFatalError(res, '', 'Submit an error report.');\n                const writtenBytes = startsAt + WPStagingLegacyDatabase.upload.iop;\n                const percent = Math.floor((writtenBytes / WPStagingLegacyDatabase.upload.file.size) * 100);\n                if (endsAt >= WPStagingLegacyDatabase.upload.file.size) {\n                  WPStagingLegacyDatabase.upload.uploadInfo(false);\n                  WPStagingLegacyDatabase.isLoading(false);\n                  $('.wpstg--modal--actions .swal2-confirm').prop('disabled', false);\n                  return;\n                }\n                $('.wpstg--modal--import--upload--progress--title > span').text(percent);\n                $('.wpstg--modal--import--upload--progress').css('width', `${percent}%`);\n                WPStagingLegacyDatabase.upload.sendChunk(endsAt);\n              })\n              .catch((e) => WPStagingLegacyDatabase.showAjaxFatalError(e, '', 'Submit an error report.'))\n          ;\n        };\n        WPStagingLegacyDatabase.upload.reader.readAsDataURL(blob);\n      },\n    },\n    status: {\n      hasResponse: null,\n      reTryAfter: 5000,\n    },\n    fetchListing(isResetErrors = true) {\n      WPStagingLegacyDatabase.isLoading(true);\n\n      if (isResetErrors) {\n        WPStagingLegacyDatabase.resetErrors();\n      }\n\n      return fetch(`${ajaxurl}?action=wpstg--backups--database-legacy-listing&_=${Math.random()}&accessToken=${wpstg.accessToken}&nonce=${wpstg.nonce}`)\n          .then(WPStagingLegacyDatabase.handleFetchErrors)\n          .then((res) => res.json())\n          .then((res) => {\n            WPStagingLegacyDatabase.showAjaxFatalError(res, '', 'Submit an error report.');\n            WPStagingLegacyDatabase.cache.get('#wpstg--tab--database-backups').html(res);\n            WPStagingLegacyDatabase.isLoading(false);\n            return res;\n          })\n          .catch((e) => WPStagingLegacyDatabase.showAjaxFatalError(e, '', 'Submit an error report.'))\n      ;\n    },\n    delete() {\n      $('#wpstg--tab--database-backups')\n          .off('click', '.wpstg-delete-backup[data-id]')\n          .on('click', '.wpstg-delete-backup[data-id]', function(e) {\n            e.preventDefault();\n            WPStagingLegacyDatabase.resetErrors();\n            WPStagingLegacyDatabase.isLoading(true);\n            WPStagingLegacyDatabase.cache.get('#wpstg-existing-database-backups').hide();\n            const id = this.getAttribute('data-id');\n            WPStagingLegacyDatabase.ajax(\n                {\n                  action: 'wpstg--backups--database-legacy-delete-confirm',\n                  id: id,\n                  accessToken: wpstg.accessToken,\n                  nonce: wpstg.nonce,\n                },\n                function(response) {\n                  WPStagingLegacyDatabase.showAjaxFatalError(response, '', ' Please submit an error report by using the REPORT ISSUE button.');\n                  WPStagingLegacyDatabase.isLoading(false);\n                  WPStagingLegacyDatabase.cache.get('#wpstg-delete-confirmation').html(response);\n                },\n            );\n          })\n      // Delete final confirmation page\n          .off('click', '#wpstg-delete-backup')\n          .on('click', '#wpstg-delete-backup', function(e) {\n            e.preventDefault();\n            WPStagingLegacyDatabase.resetErrors();\n            WPStagingLegacyDatabase.isLoading(true);\n            const id = this.getAttribute('data-id');\n            WPStagingLegacyDatabase.ajax(\n                {\n                  action: 'wpstg--backups--database-legacy-delete',\n                  id: id,\n                  accessToken: wpstg.accessToken,\n                  nonce: wpstg.nonce,\n                },\n                function(response) {\n                  WPStagingLegacyDatabase.showAjaxFatalError(response, '', ' Please submit an error report by using the REPORT ISSUE button.');\n                  // noinspection JSIgnoredPromiseFromCall\n                  WPStagingLegacyDatabase.fetchListing();\n                  WPStagingLegacyDatabase.isLoading(false);\n                },\n            );\n          })\n          .off('click', '#wpstg-cancel-backup-delete')\n          .on('click', '#wpstg-cancel-backup-delete', function(e) {\n            e.preventDefault();\n            WPStagingLegacyDatabase.isLoading(false);\n            // noinspection JSIgnoredPromiseFromCall\n            WPStagingLegacyDatabase.fetchListing();\n          })\n      ;\n\n      // Force delete if backup tables do not exist\n      // TODO This is bloated, no need extra ID, use existing one?\n      $('#wpstg-error-wrapper')\n          .off('click', '#wpstg-backup-force-delete')\n          .on('click', '#wpstg-backup-force-delete', function(e) {\n            e.preventDefault();\n            WPStagingLegacyDatabase.resetErrors();\n            WPStagingLegacyDatabase.isLoading(true);\n            const id = this.getAttribute('data-id');\n\n            if (!confirm('Do you want to delete this backup ' + id + ' from the listed backups?')) {\n              WPStagingLegacyDatabase.isLoading(false);\n              return false;\n            }\n\n            WPStagingLegacyDatabase.ajax(\n                {\n                  action: 'wpstg--backups--database-legacy-delete',\n                  id: id,\n                  accessToken: wpstg.accessToken,\n                  nonce: wpstg.nonce,\n                },\n                function(response) {\n                  WPStagingLegacyDatabase.showAjaxFatalError(response, '', ' Please submit an error report by using the REPORT ISSUE button.');\n                  // noinspection JSIgnoredPromiseFromCall\n                  WPStagingLegacyDatabase.fetchListing();\n                  WPStagingLegacyDatabase.isLoading(false);\n                },\n            );\n          })\n      ;\n    },\n    restore() {\n      var restoreBackup = function(prefix, reset) {\n        WPStagingLegacyDatabase.isLoading(true);\n        WPStagingLegacyDatabase.resetErrors();\n\n        if (typeof reset === 'undefined') {\n          reset = false;\n        }\n\n        WPStaging.ajax(\n            {\n              action: 'wpstg--backups--database-legacy-restore',\n              accessToken: wpstg.accessToken,\n              nonce: wpstg.nonce,\n              wpstg: {\n                tasks: {\n                  backup: {\n                    database: {\n                      create: {\n                        source: prefix,\n                        reset,\n                      },\n                    },\n                  },\n                },\n              },\n            },\n            function(response) {\n              if (typeof response === 'undefined') {\n                setTimeout(function() {\n                  restoreBackup(prefix);\n                }, wpstg.delayReq);\n                return;\n              }\n\n              WPStagingLegacyDatabase.processResponse(response);\n\n              if (response.status === false || response.job_done === false) {\n                restoreBackup(prefix);\n              } else if (response.status === true && response.job_done === true) {\n                WPStagingLegacyDatabase.isLoading(false);\n                $('.wpstg--modal--process--title').text('Backup successfully restored');\n                setTimeout(() => {\n                  Swal.close();\n                  // noinspection JSIgnoredPromiseFromCall\n                  alert('Backup successfully restored. Please log-in again to WordPress.');\n                  WPStagingLegacyDatabase.fetchListing();\n                }, 1000);\n              } else {\n                setTimeout(function() {\n                  restoreBackup(prefix);\n                }, wpstg.delayReq);\n              }\n            },\n            'json',\n            false,\n            0,\n            1.25,\n        );\n      };\n\n      $('#wpstg--tab--database-backups')\n          .off('click', '.wpstg--backup--restore[data-id]')\n          .on('click', '.wpstg--backup--restore[data-id]', function(e) {\n            e.preventDefault();\n            WPStagingLegacyDatabase.resetErrors();\n            WPStagingLegacyDatabase.ajax(\n                {\n                  action: 'wpstg--backups--database-legacy-restore-confirm',\n                  accessToken: wpstg.accessToken,\n                  nonce: wpstg.nonce,\n                  id: $(this).data('id'),\n                },\n                function(data) {\n                  WPStagingLegacyDatabase.cache.get('#wpstg--tab--database-backups').html(data);\n                },\n            );\n          })\n          .off('click', '#wpstg--backup--restore--cancel')\n          .on('click', '#wpstg--backup--restore--cancel', function(e) {\n            WPStagingLegacyDatabase.resetErrors();\n            e.preventDefault();\n            // noinspection JSIgnoredPromiseFromCall\n            WPStagingLegacyDatabase.fetchListing();\n          })\n          .off('click', '#wpstg--backup--restore[data-id]')\n          .on('click', '#wpstg--backup--restore[data-id]', function(e) {\n            e.preventDefault();\n            WPStagingLegacyDatabase.resetErrors();\n            const id = this.getAttribute('data-id');\n            WPStagingLegacyDatabase.process({\n              execute: () => {\n                WPStagingLegacyDatabase.messages.reset();\n                restoreBackup(id, true);\n              },\n              isShowCancelButton: false,\n            });\n          })\n      ;\n    },\n    // Edit backups name and notes\n    edit() {\n      $('#wpstg--tab--database-backups')\n          .off('click', '.wpstg--backup--edit[data-id]')\n          .on('click', '.wpstg--backup--edit[data-id]', async function(e) {\n            e.preventDefault();\n\n            const name = $(this).data('name');\n            const notes = $(this).data('notes');\n\n            const {value: formValues} = await Swal.fire({\n              title: '',\n              html: `\n                    <label id=\"wpstg-backup-edit-name\">Backup Name</label>\n                    <input id=\"wpstg-backup-edit-name-input\" class=\"swal2-input\" value=\"${name}\">\n                    <label>Additional Notes</label>\n                    <textarea id=\"wpstg-backup-edit-notes-textarea\" class=\"swal2-textarea\">${notes}</textarea>\n                  `,\n              focusConfirm: false,\n              confirmButtonText: 'Update Backup',\n              showCancelButton: true,\n              preConfirm: () => ({\n                name: document.getElementById('wpstg-backup-edit-name-input').value || null,\n                notes: document.getElementById('wpstg-backup-edit-notes-textarea').value || null,\n              }),\n            });\n\n            if (!formValues) {\n              return;\n            }\n\n            WPStagingLegacyDatabase.ajax(\n                {\n                  action: 'wpstg--backups--database-legacy-edit',\n                  accessToken: wpstg.accessToken,\n                  nonce: wpstg.nonce,\n                  id: $(this).data('id'),\n                  name: formValues.name,\n                  notes: formValues.notes,\n                },\n                function(response) {\n                  WPStagingLegacyDatabase.showAjaxFatalError(response, '', 'Submit an error report.');\n                  // noinspection JSIgnoredPromiseFromCall\n                  WPStagingLegacyDatabase.fetchListing();\n                },\n            );\n          })\n      ;\n    },\n    cancel() {\n      WPStagingLegacyDatabase.timer.stop();\n      WPStagingLegacyDatabase.isCancelled = true;\n      Swal.close();\n      setTimeout(() => WPStagingLegacyDatabase.ajax(\n          {\n            action: 'wpstg--backups--cancel',\n            accessToken: wpstg.accessToken,\n            nonce: wpstg.nonce,\n            type: WPStagingLegacyDatabase.type,\n          },\n          function(response) {\n            WPStagingLegacyDatabase.showAjaxFatalError(response, '', 'Submit an error report.');\n          },\n      ), 500);\n    },\n    /**\n   * If process.execute exists, process.data and process.onResponse is not used\n   * process = { data: {}, onResponse: (resp) => {}, onAfterClose: () => {}, execute: () => {}, isShowCancelButton: bool }\n   * @param {object} process\n   */\n    process(process) {\n      if (typeof process.execute !== 'function' && (!process.data || !process.onResponse)) {\n        Swal.close();\n        WPStagingLegacyDatabase.showError('process.data and / or process.onResponse is not set');\n        return;\n      }\n\n      // TODO move to backend and get the contents as xhr response?\n      if (!WPStagingLegacyDatabase.modal.process.html || !WPStagingLegacyDatabase.modal.process.cancelBtnTxt) {\n        const $modal = $('#wpstg--modal--backup--process');\n        const html = $modal.html();\n        const btnTxt = $modal.attr('data-cancelButtonText');\n        WPStagingLegacyDatabase.modal.process.html = html || null;\n        WPStagingLegacyDatabase.modal.process.cancelBtnTxt = btnTxt || null;\n        $modal.remove();\n      }\n\n      $('body')\n          .off('click', '.wpstg--modal--process--logs--tail')\n          .on('click', '.wpstg--modal--process--logs--tail', function(e) {\n            e.preventDefault();\n            const container = Swal.getContainer();\n            const $logs = $(container).find('.wpstg--modal--process--logs');\n            $logs.toggle();\n            if ($logs.is(':visible')) {\n              container.childNodes[0].style.width = '100%';\n              container.style['z-index'] = 9999;\n            } else {\n              container.childNodes[0].style.width = '600px';\n            }\n          })\n      ;\n\n      process.isShowCancelButton = false !== process.isShowCancelButton;\n\n      WPStagingLegacyDatabase.modal.process.modal = Swal.mixin({\n        customClass: {\n          cancelButton: 'wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn',\n          content: 'wpstg--process--content',\n        },\n        buttonsStyling: false,\n      }).fire({\n        html: WPStagingLegacyDatabase.modal.process.html,\n        cancelButtonText: WPStagingLegacyDatabase.modal.process.cancelBtnTxt,\n        showCancelButton: process.isShowCancelButton,\n        showConfirmButton: false,\n        allowOutsideClick: false,\n        allowEscapeKey: false,\n        width: 600,\n        onRender: () => {\n          const _btnCancel = Swal.getContainer().getElementsByClassName('swal2-cancel wpstg--btn--cancel')[0];\n          const btnCancel = _btnCancel.cloneNode(true);\n          _btnCancel.parentNode.replaceChild(btnCancel, _btnCancel);\n\n          btnCancel.addEventListener('click', function(e) {\n            if (confirm('Are You Sure? This will cancel the process!')) {\n              Swal.close();\n            }\n          });\n\n          if (typeof process.execute === 'function') {\n            process.execute();\n            return;\n          }\n\n          if (!process.data || !process.onResponse) {\n            Swal.close();\n            WPStagingLegacyDatabase.showError('process.data and / or process.onResponse is not set');\n            return;\n          }\n\n          WPStagingLegacyDatabase.ajax(process.data, process.onResponse);\n        },\n        onAfterClose: () => typeof process.onAfterClose === 'function' && process.onAfterClose(),\n        onClose: () => {\n          console.log('cancelled');\n          WPStagingLegacyDatabase.cancel();\n        },\n      });\n    },\n    processResponse(response, useTitle) {\n      if (response === null) {\n        Swal.close();\n        WPStagingLegacyDatabase.showError('Invalid Response; null');\n        throw new Error(`Invalid Response; ${response}`);\n      }\n\n      const $container = $(Swal.getContainer());\n      const title = () => {\n        if ((response.title || response.statusTitle) && useTitle === true) {\n          $container.find('.wpstg--modal--process--title').text(response.title || response.statusTitle);\n        }\n      };\n      const percentage = () => {\n        if (response.percentage) {\n          $container.find('.wpstg--modal--process--percent').text(response.percentage);\n        }\n      };\n      const logs = () => {\n        if (!response.messages) {\n          return;\n        }\n        const $logsContainer = $container.find('.wpstg--modal--process--logs');\n        const stoppingTypes = [\n          WPStagingLegacyDatabase.messages.ERROR,\n          WPStagingLegacyDatabase.messages.CRITICAL,\n        ];\n        const appendMessage = (message) => {\n          if (Array.isArray(message)) {\n            for (const item of message) {\n              appendMessage(item);\n            }\n            return;\n          }\n          const msgClass = `wpstg--modal--process--msg--${message.type.toLowerCase()}`;\n          $logsContainer.append(`<p class=\"${msgClass}\">[${message.type}] - [${message.date}] - ${message.message}</p>`);\n\n          if (stoppingTypes.includes(message.type.toLowerCase())) {\n            WPStagingLegacyDatabase.cancel();\n            setTimeout(WPStagingLegacyDatabase.logsModal, 500);\n          }\n        };\n        for (const message of response.messages) {\n          if (!message) {\n            continue;\n          }\n          WPStagingLegacyDatabase.messages.addMessage(message);\n          appendMessage(message);\n        }\n\n        if ($logsContainer.is(':visible')) {\n          $logsContainer.scrollTop($logsContainer[0].scrollHeight);\n        }\n\n        if (!WPStagingLegacyDatabase.messages.shouldWarn()) {\n          return;\n        }\n\n        const $btnShowLogs = $container.find('.wpstg--modal--process--logs--tail');\n        $btnShowLogs.html($btnShowLogs.attr('data-txt-bad'));\n\n        $btnShowLogs\n            .find('.wpstg--modal--logs--critical-count')\n            .text(WPStagingLegacyDatabase.messages.countByType(WPStagingLegacyDatabase.messages.CRITICAL))\n        ;\n\n        $btnShowLogs\n            .find('.wpstg--modal--logs--error-count')\n            .text(WPStagingLegacyDatabase.messages.countByType(WPStagingLegacyDatabase.messages.ERROR))\n        ;\n\n        $btnShowLogs\n            .find('.wpstg--modal--logs--warning-count')\n            .text(WPStagingLegacyDatabase.messages.countByType(WPStagingLegacyDatabase.messages.WARNING))\n        ;\n      };\n\n      title();\n      percentage();\n      logs();\n\n      if (response.status === true && response.job_done === true) {\n        WPStagingLegacyDatabase.timer.stop();\n        WPStagingLegacyDatabase.isCancelled = true;\n      }\n    },\n    requestData(notation, data) {\n      const obj = {};\n      const keys = notation.split('.');\n      const lastIndex = keys.length - 1;\n      keys.reduce((accumulated, current, index) => {\n        return accumulated[current] = index >= lastIndex ? data : {};\n      }, obj);\n      return obj;\n    },\n    logsModal() {\n      Swal.fire({\n        html: `<div class=\"wpstg--modal--error--logs\" style=\"display:block\"></div><div class=\"wpstg--modal--process--logs\" style=\"display:block\"></div>`,\n        width: '95%',\n        onRender: () => {\n          const $container = $(Swal.getContainer());\n          $container[0].style['z-index'] = 9999;\n\n          const $logsContainer = $container.find('.wpstg--modal--process--logs');\n          const $errorContainer = $container.find('.wpstg--modal--error--logs');\n          const $translations = $('#wpstg--js--translations');\n          const messages = WPStagingLegacyDatabase.messages;\n          const title = $translations.attr('data-modal-logs-title')\n              .replace('{critical}', messages.countByType(messages.CRITICAL))\n              .replace('{errors}', messages.countByType(messages.ERROR))\n              .replace('{warnings}', messages.countByType(messages.WARNING))\n        ;\n\n          $errorContainer.before(`<h3>${title}</h3>`);\n          const warnings = [\n            WPStagingLegacyDatabase.messages.CRITICAL,\n            WPStagingLegacyDatabase.messages.ERROR,\n            WPStagingLegacyDatabase.messages.WARNING,\n          ];\n\n          if (!WPStagingLegacyDatabase.messages.shouldWarn()) {\n            $errorContainer.hide();\n          }\n\n          for (const message of messages.data.all) {\n            const msgClass = `wpstg--modal--process--msg--${message.type.toLowerCase()}`;\n            // TODO RPoC\n            if (warnings.includes(message.type)) {\n              $errorContainer.append(\n                  `<p class=\"${msgClass}\">[${message.type}] - [${message.date}] - ${message.message}</p>`,\n              );\n            }\n            $logsContainer.append(\n                `<p class=\"${msgClass}\">[${message.type}] - [${message.date}] - ${message.message}</p>`,\n            );\n          }\n        },\n        onOpen: (container) => {\n          const $logsContainer = $(container).find('.wpstg--modal--process--logs');\n          $logsContainer.scrollTop($logsContainer[0].scrollHeight);\n        },\n      });\n    },\n    downloadModal({title = null, titleExport = null, id = null, url = null, btnTxtCancel = 'Cancel', btnTxtConfirm = 'Download'}) {\n      if (null === WPStagingLegacyDatabase.modal.download.html) {\n        const $el = $('#wpstg--modal--backup--download');\n        WPStagingLegacyDatabase.modal.download.html = $el.html();\n        $el.remove();\n      }\n\n      const exportModal = () => Swal.fire({\n        html: `<h2>${titleExport}</h2><span class=\"wpstg-loader\"></span>`,\n        showCancelButton: false,\n        showConfirmButton: false,\n        onRender: () => {\n          WPStagingLegacyDatabase.ajax(\n              {\n                action: 'wpstg--backups--database-legacy-export',\n                accessToken: wpstg.accessToken,\n                nonce: wpstg.nonce,\n                id,\n              },\n              function(response) {\n                console.log(response);\n                if (!response || !response.success || !response.data || response.data.length < 1) {\n                  return;\n                }\n\n                const a = document.createElement('a');\n                a.style.display = 'none';\n                a.href = response.data;\n                document.body.appendChild(a);\n                a.click();\n                document.body.removeChild(a);\n\n                Swal.close();\n              },\n          );\n        },\n      });\n\n      Swal.mixin({\n        customClass: {\n          cancelButton: 'wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn',\n          confirmButton: 'wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn',\n          actions: 'wpstg--modal--actions',\n        },\n        buttonsStyling: false,\n      })\n          .fire({\n            icon: 'success',\n            html: WPStagingLegacyDatabase.modal.download.html.replace('{title}', title).replace('{btnTxtLog}', 'Show Logs'),\n            cancelButtonText: btnTxtCancel,\n            confirmButtonText: btnTxtConfirm,\n            showCancelButton: true,\n            showConfirmButton: true,\n          })\n          .then((isConfirm) => {\n            if (!isConfirm || !isConfirm.value) {\n              return;\n            }\n\n            if (url && url.length > 0) {\n              window.location.href = url;\n              return;\n            }\n\n            exportModal();\n          })\n      ;\n    },\n    importModal() {\n      const restoreSiteBackup = (data) => {\n        WPStagingLegacyDatabase.resetErrors();\n\n        if (WPStagingLegacyDatabase.isCancelled) {\n          console.log('cancelled');\n          // Swal.close();\n          return;\n        }\n\n        const reset = data['reset'];\n        delete data['reset'];\n        data['mergeMediaFiles'] = 1; // always merge for uploads / media\n        let requestData = Object.assign({}, data);\n\n        requestData = WPStagingLegacyDatabase.requestData(\n            'jobs.backup.site.restore',\n            {...WPStagingLegacyDatabase.modal.import.data},\n        );\n\n        WPStagingLegacyDatabase.timer.start();\n\n        const statusStop = () => {\n          console.log('Status: Stop');\n          clearInterval(WPStagingLegacyDatabase.processInfo.interval);\n          WPStagingLegacyDatabase.processInfo.interval = null;\n        };\n        const status = () => {\n          if (WPStagingLegacyDatabase.processInfo.interval !== null) {\n            return;\n          }\n          console.log('Status: Start');\n          WPStagingLegacyDatabase.processInfo.interval = setInterval(() => {\n            if (true === WPStagingLegacyDatabase.isCancelled) {\n              statusStop();\n              return;\n            }\n\n            if (WPStagingLegacyDatabase.status.hasResponse === false) {\n              return;\n            }\n\n            WPStagingLegacyDatabase.status.hasResponse = false;\n            fetch(`${ajaxurl}?action=wpstg--backups--status&process=restore&accessToken=${wpstg.accessToken}&nonce=${wpstg.nonce}`)\n                .then((res) => res.json())\n                .then((res) => {\n                  WPStagingLegacyDatabase.status.hasResponse = true;\n                  if (typeof res === 'undefined') {\n                    statusStop();\n                  }\n\n                  if (WPStagingLegacyDatabase.processInfo.title === res.currentStatusTitle) {\n                    return;\n                  }\n\n                  WPStagingLegacyDatabase.processInfo.title = res.currentStatusTitle;\n                  const $container = $(Swal.getContainer());\n                  $container.find('.wpstg--modal--process--title').text(res.currentStatusTitle);\n                  $container.find('.wpstg--modal--process--percent').text('0');\n                })\n                .catch((e) => {\n                  WPStagingLegacyDatabase.status.hasResponse = true;\n                  WPStagingLegacyDatabase.showAjaxFatalError(e, '', 'Submit an error report.');\n                })\n            ;\n          }, 5000);\n        };\n\n        WPStaging.ajax(\n            {\n              action: 'wpstg--backups--database-legacy-restore',\n              accessToken: wpstg.accessToken,\n              nonce: wpstg.nonce,\n              reset,\n              wpstg: requestData,\n            },\n            function(response) {\n              if (typeof response === 'undefined') {\n                setTimeout(function() {\n                  restoreSiteBackup(data);\n                }, wpstg.delayReq);\n                return;\n              }\n\n              WPStagingLegacyDatabase.processResponse(response, true);\n              if (!WPStagingLegacyDatabase.processInfo.interval) {\n                status();\n              }\n\n              if (response.status === false) {\n                restoreSiteBackup(data);\n              } else if (response.status === true) {\n                $('#wpstg--progress--status').text('Backup successfully restored!');\n                WPStagingLegacyDatabase.type = null;\n                if (WPStagingLegacyDatabase.messages.shouldWarn()) {\n                  // noinspection JSIgnoredPromiseFromCall\n                  WPStagingLegacyDatabase.fetchListing();\n                  WPStagingLegacyDatabase.logsModal();\n                  return;\n                }\n                statusStop();\n                const logEntries = $('.wpstg--modal--process--logs').get(1).innerHTML;\n                const html = '<div class=\"wpstg--modal--process--logs\">' + logEntries + '</div>';\n                const issueFound = html.includes('wpstg--modal--process--msg--warning') || html.includes('wpstg--modal--process--msg--error') ? 'Issues(s) found! ' : '';\n                console.log('errors found: ' + issueFound);\n                // var errorMessage = html.includes('wpstg--modal--process--msg--error') ? 'Errors(s) found! ' : '';\n                // var Message = warningMessage + errorMessage;\n\n                // Swal.close();\n                Swal.fire({\n                  icon: 'success',\n                  title: 'Finished',\n                  html: 'System restored from backup. <br/><span class=\"wpstg--modal--process--msg-found\">' + issueFound + '</span><button class=\"wpstg--modal--process--logs--tail\" data-txt-bad=\"\">Show Logs</button><br/>' + html,\n                },\n                );\n\n                // noinspection JSIgnoredPromiseFromCall\n                WPStagingLegacyDatabase.fetchListing();\n              } else {\n                setTimeout(function() {\n                  restoreSiteBackup(data);\n                }, wpstg.delayReq);\n              }\n            },\n            'json',\n            false,\n            0, // Don't retry upon failure\n            1.25,\n        );\n      };\n\n      if (!WPStagingLegacyDatabase.modal.import.html) {\n        const $modal = $('#wpstg--modal--backup--import');\n\n        // Search & Replace Form\n        const $form = $modal.find('.wpstg--modal--backup--import--search-replace--input--container');\n        WPStagingLegacyDatabase.modal.import.searchReplaceForm = $form.html();\n        $form.find('.wpstg--modal--backup--import--search-replace--input-group').remove();\n        $form.html(WPStagingLegacyDatabase.modal.import.searchReplaceForm.replace(/{i}/g, 0));\n\n        WPStagingLegacyDatabase.modal.import.html = $modal.html();\n        WPStagingLegacyDatabase.modal.import.baseDirectory = $modal.attr('data-baseDirectory');\n        WPStagingLegacyDatabase.modal.import.btnTxtNext = $modal.attr('data-nextButtonText');\n        WPStagingLegacyDatabase.modal.import.btnTxtConfirm = $modal.attr('data-confirmButtonText');\n        WPStagingLegacyDatabase.modal.import.btnTxtCancel = $modal.attr('data-cancelButtonText');\n        $modal.remove();\n      }\n\n      WPStagingLegacyDatabase.modal.import.data.search = [];\n      WPStagingLegacyDatabase.modal.import.data.replace = [];\n\n      let $btnConfirm = null;\n      Swal\n          .mixin({\n            customClass: {\n              confirmButton: 'wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn',\n              cancelButton: 'wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn',\n              actions: 'wpstg--modal--actions',\n            },\n            buttonsStyling: false,\n            // progressSteps: ['1', '2']\n          })\n          .queue([{\n            html: WPStagingLegacyDatabase.modal.import.html,\n            confirmButtonText: WPStagingLegacyDatabase.modal.import.btnTxtNext,\n            showCancelButton: false,\n            showConfirmButton: true,\n            showLoaderOnConfirm: true,\n            width: 650,\n            onRender() {\n              $btnConfirm = $('.wpstg--modal--actions .swal2-confirm');\n              $btnConfirm.prop('disabled', true);\n\n              WPStagingLegacyDatabase.modal.import.containerUpload = $('.wpstg--modal--backup--import--upload');\n              WPStagingLegacyDatabase.modal.import.containerFilesystem = $('.wpstg--modal--backup--import--filesystem');\n            },\n            preConfirm() {\n              const body = new FormData;\n              body.append('accessToken', wpstg.accessToken);\n              body.append('nonce', wpstg.nonce);\n              body.append('filePath', WPStagingLegacyDatabase.modal.import.data.file);\n\n              WPStagingLegacyDatabase.modal.import.data.search.forEach((item, index) => {\n                body.append(`search[${index}]`, item);\n              });\n              WPStagingLegacyDatabase.modal.import.data.replace.forEach((item, index) => {\n                body.append(`replace[${index}]`, item);\n              });\n\n              return fetch(`${ajaxurl}?action=wpstg--backups--import--file-info`, {\n                method: 'POST',\n                body,\n              }).then(WPStagingLegacyDatabase.handleFetchErrors)\n                  .then((res) => res.json())\n                  .then((html) => {\n                    return Swal.insertQueueStep({\n                      html: html,\n                      confirmButtonText: WPStagingLegacyDatabase.modal.import.btnTxtConfirm,\n                      cancelButtonText: WPStagingLegacyDatabase.modal.import.btnTxtCancel,\n                      showCancelButton: true,\n                    });\n                  })\n                  .catch((e) => WPStagingLegacyDatabase.showAjaxFatalError(e, '', 'Submit an error report.'))\n              ;\n            },\n          }])\n          .then((res) => {\n            if (!res || !res.value || !res.value[1] || res.value[1] !== true) {\n              return;\n            }\n\n            WPStagingLegacyDatabase.isCancelled = false;\n            const data = WPStagingLegacyDatabase.modal.import.data;\n            data['file'] = WPStagingLegacyDatabase.modal.import.baseDirectory + data['file'];\n            data['reset'] = true;\n\n            WPStagingLegacyDatabase.process({\n              execute: () => {\n                WPStagingLegacyDatabase.messages.reset();\n                restoreSiteBackup(data);\n              },\n            });\n          })\n      ;\n    },\n  };\n}(jQuery));\n"],"names":["$","window","addEventListener","WPStagingLegacyDatabase","init","type","isCancelled","processInfo","title","interval","cache","elements","get","selector","inArray","this","refresh","fetchListing","create","restore","edit","off","on","$records","find","value","show","filter","hide","url","getAttribute","length","location","href","downloadModal","titleExport","id","btnTxtCancel","btnTxtConfirm","importModal","$parent","parent","hasClass","removeClass","text","attr","addClass","e","preventDefault","$container","Swal","getContainer","total","append","modal","searchReplaceForm","replace","index","parseInt","isNaN","data","search","option","containerFilesystem","containerUpload","click","fetch","ajaxurl","Math","random","wpstg","accessToken","nonce","then","handleFetchErrors","res","json","$ul","empty","isEmpty","forEach","file","fullPath","name","size","showAjaxFatalError","setFile","files","prop","stopPropagation","originalEvent","dataTransfer","createBackup","resetErrors","reset","requestData","Object","assign","useResponseTitle","close","showError","jobs","backup","site","directories","wpContentDir","excludedDirectories","availableDirectories","split","item","includedDirectories","includes","map","includeOtherFilesInWpContent","wpStagingDir","timer","start","statusStop","console","log","clearInterval","WPStaging","ajax","action","response","processResponse","setInterval","status","hasResponse","currentStatusTitle","messages","shouldWarn","logsModal","backupId","$el","$logsContainer","all","message","msgClass","toLowerCase","date","setTimeout","delayReq","advancedOptions","$target","toggle","is","totalDirs","isExportDatabase","html","confirmBtnTxt","$newBackupModal","btnTxt","remove","fire","focusConfirm","confirmButtonText","showCancelButton","preConfirm","container","querySelector","notes","Array","from","querySelectorAll","i","exportDatabase","formValues","process","execute","obj","hasOwnProperty","isLoading","prependMessage","appendMessage","removeEventListener","warnIfClosingDuringProcess","error","ok","statusText","css","callback","dataType","showErrors","tryCount","incrementRatio","retryLimit","retryTimeout","Date","now","xhr","textStatus","errorThrown","errorCode","success","statusCode","cancelBtnTxt","download","btnTxtNext","upload","bytes","floor","pow","toFixed","baseDirectory","WARNING","ERROR","INFO","DEBUG","CRITICAL","info","critical","warning","debug","countByType","addMessage","isArray","push","totalSeconds","seconds","toISOString","substr","stop","reader","iop","uploadInfo","isShow","$containerUpload","$containerUploader","FileReader","sendChunk","startsAt","isReset","endsAt","blob","slice","onloadend","event","target","readyState","DONE","body","FormData","result","method","writtenBytes","percent","readAsDataURL","reTryAfter","isResetErrors","confirm","restoreBackup","prefix","tasks","database","source","job_done","alert","isShowCancelButton","document","getElementById","cancel","onResponse","$modal","$logs","childNodes","style","width","mixin","customClass","cancelButton","content","buttonsStyling","cancelButtonText","showConfirmButton","allowOutsideClick","allowEscapeKey","onRender","_btnCancel","getElementsByClassName","btnCancel","cloneNode","parentNode","replaceChild","onAfterClose","onClose","useTitle","Error","statusTitle","percentage","stoppingTypes","scrollTop","scrollHeight","$btnShowLogs","logs","notation","keys","lastIndex","reduce","accumulated","current","$errorContainer","$translations","before","warnings","onOpen","confirmButton","actions","icon","isConfirm","a","createElement","display","appendChild","removeChild","restoreSiteBackup","innerHTML","issueFound","$form","queue","showLoaderOnConfirm","insertQueueStep","jQuery"],"mappings":"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"}