!function(){"use strict";function e(e,t,s,n,a,o,i){try{var r=e[o](i),c=r.value}catch(e){return void s(e)}r.done?t(c):Promise.resolve(c).then(n,a)}function t(t){return function(){var s=this,n=arguments;return new Promise((function(a,o){var i=t.apply(s,n);function r(t){e(i,a,o,r,c,"next",t)}function c(t){e(i,a,o,r,c,"throw",t)}r(void 0)}))}}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e}).apply(this,arguments)}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}function a(e,t){var s;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(s=function(e,t){if(e){if("string"==typeof e)return n(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(s=e[Symbol.iterator]()).next.bind(s)}function o(e){return document.querySelector(e)}function i(e){return document.querySelectorAll(e)}function r(e,t,s,n){e.addEventListener(t,(function(e){e.target.matches(s+", "+s+" *")&&n(e.target.closest(s),e)}),!1)}function c(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var s=e.offsetHeight;e.style.height="0px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height=s+"px",window.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function l(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var s=e.offsetHeight;e.style.height=s+"px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height="0px",window.setTimeout((function(){e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}var p=function(){function e(e,t){void 0===e&&(e="#wpstg-clonepage-wrapper"),void 0===t&&(t=wpstg),this.pageWrapper=o(e),this.wpstgObject=t,this.enableButtonId="#wpstg-enable-staging-cloning",this.enableAction="wpstg_enable_staging_cloning",this.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]}),this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.pageWrapper&&r(this.pageWrapper,"click",this.enableButtonId,(function(){e.sendRequest(e.enableAction)}))},t.init=function(){this.addEvents()},t.sendRequest=function(e){var t=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){void 0!==e.success&&e.success?location.reload():void 0===e.message?t.notyf.error(t.wpstgObject.i18n.somethingWentWrong):t.notyf.error(e.message)})).catch((function(e){console.warn(t.wpstgObject.i18n.somethingWentWrong,e)}))},e}(),u=function(){function e(e,t,s){void 0===e&&(e="#wpstg-directories-listing"),void 0===t&&(t=wpstg),void 0===s&&(s=null),this.directoryListingContainer=o(e),this.wpstgObject=t,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_childrens",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.notyf=s,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.directoryListingContainer?(r(this.directoryListingContainer,"click",this.dirExpandSelector,(function(t,s){s.preventDefault(),e.toggleDirExpand(t)&&e.sendRequest(e.fetchChildrenAction,t)})),r(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){e.unselectAll()})),r(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){e.selectDefault()}))):console.log("Error: directory navigation add events")},t.init=function(){this.addEvents(),this.parseExcludes()},t.toggleDirExpand=function(e){return this.currentParentDiv=e.parentElement,this.currentCheckboxElement=e.previousSibling,this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("data-navigateable","false")&&"false"===this.currentCheckboxElement.getAttribute("data-scanned","false")},t.sendRequest=function(e){var t=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block"),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:this.currentCheckboxElement.value,isChecked:this.currentCheckboxElement.checked,forceDefault:this.isDefaultSelected}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(void 0!==e.success&&e.success){t.currentCheckboxElement.setAttribute("data-scanned",!0);var s=document.createElement("div");return s.classList.add("wpstg-dir"),s.classList.add("wpstg-subdir"),s.innerHTML=JSON.parse(e.directoryListing),t.currentParentDiv.appendChild(s),null!==t.currentLoader&&(t.currentLoader.style.display="none"),void c(s)}null!==t.notyf?t.notyf.error(t.wpstgObject.i18n.somethingWentWrong):alert("Error: "+t.wpstgObject.i18n.somethingWentWrong)})).catch((function(e){console.warn(t.wpstgObject.i18n.somethingWentWrong,e)}))},t.getExcludedDirectories=function(){var e=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir input:not(:checked)").forEach((function(t){e.isParentExcluded(t.value)||e.excludedDirectories.push(t.value)})),this.existingExcludes.forEach((function(t){e.isParentExcluded(t)||e.isExcludeScanned(t)||e.excludedDirectories.push(t)})),this.excludedDirectories.join(this.wpstgObject.settings.directorySeparator)},t.isParentExcluded=function(e){var t=!1;return this.excludedDirectories.forEach((function(s){e.startsWith(s+"/")&&(t=!0)})),t},t.getExtraDirectoriesRootOnly=function(){this.getExcludedDirectories();var e=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir>input.wpstg-wp-non-core-dir:checked").forEach((function(t){e.push(t.value)}));var t=o("#wpstg_extraDirectories");if(null===t||""===t.value)return e.join(this.wpstgObject.settings.directorySeparator);var s=t.value.split(/\r?\n/);return e.concat(s).join(this.wpstgObject.settings.directorySeparator)},t.unselectAll=function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir input").forEach((function(e){e.checked=!1}))},t.selectDefault=function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir input.wpstg-wp-core-dir").forEach((function(e){e.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg-wp-non-core-dir").forEach((function(e){e.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(e){e.checked=!1}))})),this.isDefaultSelected=!0},t.parseExcludes=function(){this.existingExcludes=this.directoryListingContainer.getAttribute("data-existing-excludes",[]),""===this.existingExcludes&&(this.existingExcludes=[]),0!==this.existingExcludes.length&&(this.existingExcludes=this.existingExcludes.split(","))},t.isExcludeScanned=function(e){return this.directoryListingContainer.querySelectorAll(".wpstg-dir input").forEach((function(t){if(t.value===e)return!0})),!1},e}(),d=function(){function e(e,t){void 0===e&&(e="#wpstg-exclude-filters-container"),void 0===t&&(t=wpstg),this.excludeContainer=o(e),this.excludeTableBody=o(e+" tbody"),this.wpstgObject=t,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;r(this.excludeContainer,"click",".wpstg-file-size-rule",(function(){e.addFileSizeExclude()})),r(this.excludeContainer,"click",".wpstg-file-ext-rule",(function(){e.addFileExtExclude()})),r(this.excludeContainer,"click",".wpstg-file-name-rule",(function(){e.addFileNameExclude()})),r(this.excludeContainer,"click",".wpstg-dir-name-rule",(function(){e.addDirNameExclude()})),r(this.excludeContainer,"click",".wpstg-clear-all-rules",(function(){e.clearExcludes()})),r(this.excludeContainer,"click",".wpstg-remove-exclude-rule",(function(t){e.removeExclude(t)}))},t.init=function(){null!==this.excludeContainer?this.addEvents():console.log("Error: Given table selector not found!")},t.addFileSizeExclude=function(){this.addExcludeRuleRow("#wpstg-file-size-exclude-filter-template")},t.addFileExtExclude=function(){this.addExcludeRuleRow("#wpstg-file-ext-exclude-filter-template")},t.addFileNameExclude=function(){this.addExcludeRuleRow("#wpstg-file-name-exclude-filter-template")},t.addDirNameExclude=function(){this.addExcludeRuleRow("#wpstg-dir-name-exclude-filter-template")},t.addExcludeRuleRow=function(e){var t=o(e);if(null!==t){var s=t.content.cloneNode(!0).querySelector("tr");this.excludeTableBody.appendChild(s),i(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="inherit"}))}},t.clearExcludes=function(){this.excludeTableBody.innerHTML="",i(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="none"}))},t.removeExclude=function(e){null!==e.parentElement&&null!==e.parentElement.parentElement&&this.excludeTableBody.removeChild(e.parentElement.parentElement),""===this.excludeTableBody.innerHTML.trim()&&i(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="none"}))},t.getExcludeFilters=function(){for(var e=this,t=[],s=[],n=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleCompare[]"]'),a=this.excludeTableBody.querySelectorAll('input[name="wpstgFileSizeExcludeRuleSize[]"]'),o=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleByte[]"]'),i=0,r=Object.entries(a);i<r.length;i++){var c=r[i],l=c[0],p=c[1];""!==p.value&&s.push(n[l].value+" "+p.value+o[l].value)}this.excludeTableBody.querySelectorAll('input[name="wpstgFileExtExcludeRule[]"]').forEach((function(s){var n=e.cleanStringForGlob(s.value);""!==n&&t.push("ext:"+n.trim())}));for(var u=this.excludeTableBody.querySelectorAll('select[name="wpstgFileNameExcludeRulePos[]"]'),d=this.excludeTableBody.querySelectorAll('input[name="wpstgFileNameExcludeRulePath[]"]'),g=0,w=Object.entries(d);g<w.length;g++){var h=w[g],f=h[0],m=h[1],b=this.cleanStringForGlob(m.value);""!==b&&t.push("file:"+u[f].value+" "+b.trim())}for(var k=this.excludeTableBody.querySelectorAll('select[name="wpstgDirNameExcludeRulePos[]"]'),v=this.excludeTableBody.querySelectorAll('input[name="wpstgDirNameExcludeRulePath[]"]'),y=0,x=Object.entries(v);y<x.length;y++){var C=x[y],S=C[0],T=C[1],E=this.cleanStringForGlob(T.value);""!==E&&t.push("dir:"+k[S].value+" "+E.trim())}return{sizes:s.filter(this.onlyUnique).join(","),globs:t.filter(this.onlyUnique).join(",")}},t.onlyUnique=function(e,t,s){return s.indexOf(e)===t},t.cleanStringForGlob=function(e){return e.replace(/[*^//!\.[?]/g,"")},e}(),g=function(){function e(e,t){void 0===t&&(t=wpstg),this.confirmAction=e,this.wpstgObject=t}var t=e.prototype;return t.show=function(e,t,s){var n=this;void 0===t&&(t={}),void 0===s&&(s=null),Swal.fire(e).then((function(e){e.value&&null!==n.error&&n.triggerConfirmAction(t,s)}))},t.triggerConfirmAction=function(e,t){var s=this;void 0===e&&(e={}),void 0===t&&(t=null),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams(Object.assign({action:this.confirmAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce},e)),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){null!==t&&t(e)})).catch((function(e){console.log(s.wpstgObject.i18n.somethingWentWrong,e)}))},e}(),w=function(){function e(e,t,s,n,a){void 0===t&&(t="#wpstg-workflow"),void 0===s&&(s="wpstg_clone_excludes_settings"),void 0===n&&(n="wpstg_modal_error"),void 0===a&&(a=wpstg),this.cloneID=e,this.workflow=o(t),this.wpstgObject=a,this.fetchExcludeSettingsAction=s,this.modalErrorAction=n,this.resetButtonClass="wpstg-confirm-reset-clone",this.resetModalContainerClass="wpstg-reset-confirmation",this.resetTabSelector=".wpstg-reset-exclude-tab",this.directoryNavigator=null,this.excludeFilters=null,this.isAllTablesChecked=!0}var t=e.prototype;return t.addEvents=function(){var e=this,t=o("."+this.resetModalContainerClass);null!==t?(r(t,"click",this.resetTabSelector,(function(t){e.toggleContent(t)})),r(t,"click",".wpstg-button-select",(function(){e.selectDefaultTables()})),r(t,"click",".wpstg-button-unselect",(function(){e.toggleTableSelection()})),r(t,"click",".wpstg-expand-dirs",(function(t,s){s.preventDefault(),e.toggleDirectoryNavigation(t)})),r(t,"change","input.wpstg-check-dir",(function(t){e.updateDirectorySelection(t)}))):console.log("Exit")},t.init=function(){this.addEvents()},t.toggleContent=function(e){var t=o("."+this.resetModalContainerClass),s=e.getAttribute("data-id"),n=e.querySelector(".wpstg-tab-triangle"),a=e.getAttribute("data-collapsed","true"),i=o(s);"true"===a?(t.classList.contains("has-collapsible-open")?t.classList.add("has-collapsible-open-2"):t.classList.add("has-collapsible-open"),c(i),n.style.transform="rotate(90deg)",e.setAttribute("data-collapsed","false")):(t.classList.contains("has-collapsible-open-2")?t.classList.remove("has-collapsible-open-2"):t.classList.remove("has-collapsible-open"),l(i),n.style.removeProperty("transform"),e.setAttribute("data-collapsed","true"))},t.showModal=function(){var e=this.loadModal();return this.init(),this.fetchCloneExcludes(),e},t.loadModal=function(){return Swal.fire({title:"",icon:"warning",html:this.getAjaxLoader(),width:"300px",focusConfirm:!1,customClass:{confirmButton:this.resetButtonClass,container:"wpstg-swal2-container wpstg-swal2-loading "+this.resetModalContainerClass},confirmButtonText:this.wpstgObject.i18n.resetClone,showCancelButton:!0})},t.fetchCloneExcludes=function(){var e=this;this.error=null,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.fetchExcludeSettingsAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneID,job:"resetting"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){if(t.success){var s=o(".wpstg-reset-confirmation");s.classList.remove("wpstg-swal2-loading"),s.querySelector(".swal2-popup").style.width="auto",s.querySelector(".swal2-content").innerHTML=t.html,e.directoryNavigator=new u,e.excludeFilters=new d}else{new g(e.modalErrorAction,e.wpstgObject).show(Object.assign({title:"Error",icon:"error",html:e.wpstgObject.i18n.somethingWentWrong,width:"500px",confirmButtonText:"Ok",showCancelButton:!1},t.swalOptions),{type:t.type})}})).catch((function(t){e.renderError({html:e.wpstgObject.i18n.somethingWentWrong+" "+t})}))},t.getDirectoryNavigator=function(){return this.directoryNavigator},t.getExcludeFilters=function(){return this.excludeFilters},t.getAjaxLoader=function(){return'<div class="wpstg-swal2-ajax-loader"><img src="'+this.wpstgObject.wpstgIcon+'" /></div>'},t.toggleDirectoryNavigation=function(e){var t=e.previousSibling;if("false"!==t.getAttribute("data-navigateable","false")&&"false"!==t.getAttribute("data-scanned","false")){var s=function(e,t){for(var s=e.nextElementSibling;s;){if(s.matches(t))return s;s=s.nextElementSibling}}(e,".wpstg-subdir");"none"===s.style.display?c(s):l(s)}},t.updateDirectorySelection=function(e){var t=e.parentElement;e.checked?(function(e,t){for(var s=[],n=e&&e.parentElement;n;n=n.parentElement)n.matches(t)&&s.push(n);return s}(t,".wpstg-dir").forEach((function(e){for(var t=0;t<e.children.length;t++)e.children[t].matches(".wpstg-check-dir")&&(e.children[t].checked=!0)})),t.querySelectorAll(".wpstg-expand-dirs").forEach((function(e){e.classList.remove("disabled")})),t.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(e){e.checked=!0}))):(t.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(e){e.classList.add("disabled")})),t.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(e){e.checked=!1})))},t.selectDefaultTables=function(){var e=this,t=o("."+this.resetModalContainerClass).querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table"),s="^"+this.wpstgObject.tblprefix+"([^0-9])_*",n="^"+this.wpstgObject.tblprefix;t.forEach((function(t){var a=t.getAttribute("name","");"1"===e.wpstgObject.isMultisite&&a.match(s)||""===e.wpstgObject.isMultisite&&a.match(n)?t.setAttribute("selected","selected"):t.removeAttribute("selected")}))},t.toggleTableSelection=function(){var e=o("."+this.resetModalContainerClass);!1===this.isAllTablesChecked?(e.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(e){e.setAttribute("selected","selected")})),e.querySelector(".wpstg-button-unselect").innerHTML="Unselect All",this.isAllTablesChecked=!0):(e.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(e){e.removeAttribute("selected")})),e.querySelector(".wpstg-button-unselect").innerHTML="Select All",this.isAllTablesChecked=!1)},e}(),h=function(e){var n,o={isCancelled:!1,isFinished:!1,getLogs:!1,time:1,executionTime:!1,progressBar:0,cloneExcludeFilters:null,directoryNavigator:null,notyf:new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]})},i={elements:[]};i.get=function(t){return-1!==e.inArray(t,i.elements)||(i.elements[t]=jQuery(t)),i.elements[t]},i.refresh=function(e){e.elements[e]=jQuery(e)};var r=function(t){i.get("#wpstg-try-again").css("display","inline-block"),i.get("#wpstg-cancel-cloning").text("Reset"),i.get("#wpstg-resume-cloning").show(),i.get("#wpstg-error-wrapper").show(),i.get("#wpstg-error-details").show().html(t),i.get("#wpstg-removing-clone").removeClass("loading"),i.get(".wpstg-loader").hide(),e(".wpstg--modal--process--generic-problem").show().html(t)};o.warnIfClosingDuringProcess=function(e){return e.returnValue="You MUST leave this window open while cloning/pushing. Please wait...",null};var c=function(e,t,s){return t=t?t+"<br/><br/>":"Something went wrong! <br/><br/>",s=s?s+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===e?(r(t+" Error: No response."+s),void window.removeEventListener("beforeunload",h.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(console.error(e.message),r(t+" Error: "+e.message+s),void window.removeEventListener("beforeunload",h.warnIfClosingDuringProcess)):void 0},l=function(e){return e.ok||r("Error: "+e.status+" - "+e.statusText+". Please try again or contact support."),e},f=function(){i.get("#wpstg-error-details").hide().html("")},m=function(){var t=e("#wpstg_clone_hostname").val();if(""===t)return!0;return!1!==/^http(s)?:\/\/.*$/.test(t)},b=function(){var t=i.get("#wpstg-workflow");t.on("click","#wpstg-cancel-cloning",(function(){if(!confirm("Are you sure you want to cancel cloning process?"))return!1;var t=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),t.prop("disabled",!0),o.isCancelled=!0,o.progressBar=0,e("#wpstg-processing-status").text("Please wait...this can take up a while."),e(".wpstg-loader, #wpstg-show-log-button").hide(),t.parent().append(n),j()})).on("click","#wpstg-resume-cloning",(function(){f();var t=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),o.isCancelled=!1,e("#wpstg-processing-status").text("Try to resume cloning process..."),e("#wpstg-error-details").hide(),e(".wpstg-loader").show(),t.parent().append(n),o.startCloning()})).on("click","#wpstg-cancel-cloning-update",(function(){f();var t=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),t.prop("disabled",!0),o.isCancelled=!0,e("#wpstg-cloning-result").text("Please wait...this can take up a while."),e(".wpstg-loader, #wpstg-show-log-button").hide(),t.parent().append(n),R()})).on("click","#wpstg-restart-cloning",(function(){f();var t=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),t.prop("disabled",!0),o.isCancelled=!0,e("#wpstg-cloning-result").text("Please wait...this can take up a while."),e(".wpstg-loader, #wpstg-show-log-button").hide(),t.parent().append(n),B()})).on("click",".wpstg-remove-clone[data-clone]",(function(s){f(),s.preventDefault();var n=i.get("#wpstg-existing-clones");t.removeClass("active"),i.get(".wpstg-loader").show(),k({action:"wpstg_confirm_delete_clone",accessToken:wpstg.accessToken,nonce:wpstg.nonce,clone:e(this).data("clone")},(function(t){i.get("#wpstg-removing-clone").html(t),n.children("img").remove(),i.get(".wpstg-loader").hide(),e("html, body").animate({scrollTop:e("#wpstg-remove-clone").offset().top-e(window).height()+e("#wpstg-remove-clone").height()+50},100)}),"HTML")})).on("click","#wpstg-remove-clone",(function(t){f(),t.preventDefault(),i.get("#wpstg-removing-clone").addClass("loading"),i.get(".wpstg-loader").show(),I(e(this).data("clone"))})).on("click","#wpstg-cancel-removing",(function(t){t.preventDefault(),e(".wpstg-clone").removeClass("active"),i.get("#wpstg-removing-clone").html("")})).on("click",".wpstg-execute-clone",(function(s){s.preventDefault();var n=e(this).data("clone");t.addClass("loading"),o.cloneExcludeFilters=null,k({action:"wpstg_scanning",clone:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){e.length<1&&r("Something went wrong! Error: No response.  Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.");var s=E(e);if(!1!==s&&!1===s.success)return t.removeClass("loading"),void T(s);t.removeClass("loading").html(e),A(),o.directoryNavigator=new u("#wpstg-directories-listing",wpstg,o.notyf),o.cloneExcludeFilters=new d,o.switchStep(2)}),"HTML")})).on("click",".wpstg-reset-clone",(function(t){t.preventDefault();var s=e(this).data("clone"),n=new w(s);n.showModal().then((function(e){if(e.value){var t=n.getDirectoryNavigator(),a=n.getExcludeFilters().getExcludeFilters();_(s,{includedTables:v(),excludeSizeRules:encodeURIComponent(a.sizes),excludeGlobRules:encodeURIComponent(a.globs),excludedDirectories:t.getExcludedDirectories(),extraDirectories:t.getExtraDirectoriesRootOnly()})}}))}))},k=function t(s,n,a,o,i,c){void 0===c&&(c=null),void 0===a&&(a="json"),!1!==o&&(o=!0);var l=10,p=1e4*(i=void 0===i?0:i);c=parseInt(c),isNaN(c)||(p*=c),e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:a,cache:!1,data:s,error:function(e,u,d){if(++i<=l)setTimeout((function(){t(s,n,a,o,i,c)}),p);else{var g=void 0===e.status?"Unknown":e.status;r("Fatal Error:  "+g+" Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")}},success:function(e){"function"==typeof n&&n(e)},statusCode:{404:function(){i>=l&&r("Error 404 - Can't find ajax request URL! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},500:function(){i>=l&&r("Fatal Error 500 - Internal server error while processing the request! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},504:function(){i>l&&r("Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},502:function(){i>=l&&r("Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},503:function(){i>=l&&r("Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},429:function(){i>=l&&r("Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},403:function(){i>=l&&r("Refresh page or login again! The process should be finished successfully. \n ")}}})},v=function(){var t=[];return e("#wpstg_select_tables_cloning option:selected").each((function(){t.push(this.value)})),t},y=function(){var t=[];return e(".wpstg-db-table input:not(:checked)").each((function(){t.push(this.name)})),t},x=function(e,t){i.get(".wpstg-loader").show(),k({action:"wpstg_database_verification",accessToken:wpstg.accessToken,nonce:wpstg.nonce,databaseUser:i.get("#wpstg_db_username").val(),databasePassword:i.get("#wpstg_db_password").val(),databaseServer:i.get("#wpstg_db_server").val(),databaseDatabase:i.get("#wpstg_db_database").val()},(function(s){if(!1===s)return r("Something went wrong! Error: No response.Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void i.get(".wpstg-loader").hide();if(void 0===s.success)return r("Something went wrong! Error: Invalid response.Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void i.get(".wpstg-loader").hide();if(s.success)return i.get(".wpstg-loader").hide(),void C(e,t);if("comparison"===s.error_type){i.get(".wpstg-loader").hide();var n='<table style="width: 100%;"><thead><tr><th>Property</th><th>Production DB</th><th>Staging DB</th><th>Status</th></tr></thead><tbody>';return s.checks.forEach((function(e){var t='<i style="color: #00ff00">✔</i>';e.production!==e.staging&&(t='<i style="color: #ff0000">❌</i>'),n+="<tr><td>"+e.name+"</td><td>"+e.production+"</td><td>"+e.staging+"</td><td>"+t+"</td></tr>"})),n+="</tbody></table><p>Note: Some mySQL properties do not match. You may proceed but the staging site may not work as expected.</p>",void Swal.fire({title:"Different Database Properties",icon:"warning",html:n,width:"650px",focusConfirm:!1,confirmButtonText:"Proceed Anyway",showCancelButton:!0}).then((function(s){s.value&&C(e,t)}))}Swal.fire({title:"Different Database Properties",icon:"error",html:s.message,focusConfirm:!0,confirmButtonText:"Ok",showCancelButton:!1}),i.get(".wpstg-loader").hide()}),"json",!1)},C=function(t,s){s.addClass("loading"),o.data={action:t.data("action"),accessToken:wpstg.accessToken,nonce:wpstg.nonce},function(){if("wpstg_cloning"===o.data.action||"wpstg_update"===o.data.action||"wpstg_reset"===o.data.action){if(o.data.cloneID=e("#wpstg-new-clone-id").val()||(new Date).getTime().toString(),null!==o.directoryNavigator&&(o.data.excludedDirectories=encodeURIComponent(o.directoryNavigator.getExcludedDirectories()),o.data.extraDirectories=encodeURIComponent(o.directoryNavigator.getExtraDirectoriesRootOnly())),o.data.excludeGlobRules="",o.data.excludeSizeRules="",o.cloneExcludeFilters instanceof d){var t=o.cloneExcludeFilters.getExcludeFilters();o.data.excludeGlobRules=encodeURIComponent(t.globs),o.data.excludeSizeRules=encodeURIComponent(t.sizes)}o.data.includedTables=v(),o.data.databaseServer=e("#wpstg_db_server").val(),o.data.databaseUser=e("#wpstg_db_username").val(),o.data.databasePassword=e("#wpstg_db_password").val(),o.data.databaseDatabase=e("#wpstg_db_database").val(),o.data.databasePrefix=e("#wpstg_db_prefix").val();var s=e("#wpstg_clone_dir").val();o.data.cloneDir=encodeURIComponent(e.trim(s)),o.data.cloneHostname=e("#wpstg_clone_hostname").val(),o.data.emailsAllowed=e("#wpstg_allow_emails").is(":checked"),o.data.uploadsSymlinked=e("#wpstg_symlink_upload").is(":checked"),o.data.cleanPluginsThemes=e("#wpstg-clean-plugins-themes").is(":checked"),o.data.cleanUploadsDir=e("#wpstg-clean-uploads").is(":checked")}}(),S(s)},S=function(e){k(o.data,(function(t){!1===t&&r("Something went wrong!<br/><br/> Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),t.length<1&&r("Something went wrong! No response.  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> ");var s=E(t);if(!1!==s&&!1===s.success)return e.removeClass("loading"),void T(s);e.removeClass("loading").html(t),o.cloneExcludeFilters=null,"wpstg_scanning"===o.data.action?(o.directoryNavigator=new u("#wpstg-directories-listing",wpstg,o.notyf),o.switchStep(2),o.cloneExcludeFilters=new d):"wpstg_cloning"!==o.data.action&&"wpstg_update"!==o.data.action&&"wpstg_reset"!==o.data.action||o.switchStep(3),o.startCloning()}),"HTML")},T=function(e){new g("wpstg_modal_error",wpstg).show(Object.assign({title:"Error",icon:"error",html:wpstg.i18n.somethingWentWrong,width:"500px",confirmButtonText:"Ok",showCancelButton:!1},e.swalOptions),{type:e.type})},E=function(e){if(!e)return!1;try{var t=JSON.parse(e);if(t&&"object"==typeof t)return t}catch(e){}return!1},_=function(e,t){o.data={action:"wpstg_reset",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneID:e},o.data=s({},o.data,t);var n=i.get("#wpstg-workflow");S(n)},D=function(){var e=i.get("#wpstg-workflow");e.addClass("loading"),k({action:"wpstg_overview",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){t.length<1&&r("Something went wrong! No response. Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report."),i.get(".wpstg-current-step"),e.removeClass("loading").html(t)}),"HTML"),o.switchStep(1),i.get(".wpstg-step3-cloning").show(),i.get(".wpstg-step3-pushing").hide()},I=function t(s){var n=e("#deleteDirectory:checked").data("deletepath");k({action:"wpstg_delete_clone",clone:s,accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedTables:y(),deleteDir:n},(function(n){if(n&&(c(n),void 0!==n.delete&&("finished"===n.delete||"unfinished"===n.delete)))return i.get("#wpstg-removing-clone").removeClass("loading").html(""),"finished"===n.delete&&e(".wpstg-clone#"+s).remove(),e(".wpstg-clone").length<1&&i.get("#wpstg-existing-clones").find("h3").text(""),void i.get(".wpstg-loader").hide();!0===n||t(s)}))},j=function e(){if(o.timer("stop"),!0===o.isFinished)return!0;k({action:"wpstg_cancel_clone",clone:o.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){if(t&&void 0!==t.delete&&"finished"===t.delete)return i.get(".wpstg-loader").hide(),void D();!0===t?D():e()}))},R=function e(){if(!0===o.isFinished)return!0;k({action:"wpstg_cancel_update",clone:o.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){t&&void 0!==t.delete&&"finished"===t.delete||!0===t?D():e()}))},B=function(){if(!0===o.isFinished)return!0;k({action:"wpstg_restart",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){e&&void 0!==e.delete&&"finished"===e.delete||!0===e?D():R()}))},P=function(t){var s;null!=t&&void 0!==t&&(t.constructor===Array?e.each(t,(function(e,t){null!==t&&("ERROR"===t.type?i.get(".wpstg-log-details").append('<span style="color:red;">['+t.type+"]</span>-["+t.date+"] "+t.message+"</br>"):i.get(".wpstg-log-details").append("["+t.type+"]-["+t.date+"] "+t.message+"</br>"))})):i.get(".wpstg-log-details").append("["+t.type+"]-["+t.date+"] "+t.message+"</br>")),void 0!==(s=i.get(".wpstg-log-details"))[0]&&s.scrollTop(s[0].scrollHeight)},A=function(){i.get("#wpstg-check-space").on("click",(function(e){i.get(".wpstg-loader").show();var t=encodeURIComponent(o.directoryNavigator.getExcludedDirectories()),s=encodeURIComponent(o.directoryNavigator.getExtraDirectoriesRootOnly());k({action:"wpstg_check_disk_space",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedDirectories:t,extraDirectories:s},(function(e){if(!1===e)return i.get("#wpstg-clone-id-error").text("Can not detect required disk space").show(),void i.get(".wpstg-loader").hide();i.get("#wpstg-clone-id-error").html("Estimated necessary disk space: "+e.usedspace+'<br> <span style="color:#444;">Before you proceed ensure your account has enough free disk space to hold the entire instance of the production site. You can check the available space from your hosting account (cPanel or similar).</span>').show(),i.get(".wpstg-loader").hide()}),"json",!1)}))},L=function(e){e&&!1!==e?i.get(".wpstg-loader").show():i.get(".wpstg-loader").hide()};return o.timer=function(e){if("stop"===e){var t=o.time;return o.time=1,clearInterval(o.executionTime),o.convertSeconds(t)}o.executionTime=setInterval((function(){null!==document.getElementById("wpstg-processing-timer")&&(document.getElementById("wpstg-processing-timer").innerHTML="Elapsed Time: "+o.convertSeconds(o.time)),o.time++,"stop"===e&&(o.time=1,clearInterval(o.executionTime))}),1e3)},o.convertSeconds=function(e){var t=new Date(null);return t.setSeconds(e),t.toISOString().substr(11,8)},o.startCloning=function(){if(f(),A(),"wpstg_cloning"===o.data.action||"wpstg_update"===o.data.action||"wpstg_reset"===o.data.action){o.isCancelled=!1,i.get(".wpstg-loader").show(),i.get("#wpstg-cancel-cloning").text("Cancel"),i.get("#wpstg-resume-cloning").hide(),i.get("#wpstg-error-details").hide(),setTimeout((function(){window.addEventListener("beforeunload",h.warnIfClosingDuringProcess),t()}),wpstg.delayReq),o.timer("start");var t=function t(){if(!0===o.isCancelled)return window.removeEventListener("beforeunload",h.warnIfClosingDuringProcess),!1;L(!0);var n="",a="";null!==o.directoryNavigator&&(n=o.directoryNavigator.getExcludedDirectories(),a=o.directoryNavigator.getExtraDirectoriesRootOnly()),i.get(".wpstg-log-details").show(),h.ajax({action:"wpstg_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedTables:y(),excludedDirectories:encodeURIComponent(n),extraDirectories:encodeURIComponent(a)},(function(n){c(n),void 0!==n.last_msg&&n.last_msg&&P(n.last_msg),!1===n.status?(s(n),setTimeout((function(){i.get(".wpstg-loader").show(),t()}),wpstg.delayReq)):!0===n.status&&"finished"!==n.status?(i.get("#wpstg-error-details").hide(),i.get("#wpstg-error-wrapper").hide(),s(n),t()):("finished"===n.status||void 0!==n.job_done&&n.job_done)&&(window.removeEventListener("beforeunload",h.warnIfClosingDuringProcess),function(t){!0===o.getLogs&&P();s(t),void 0!==t.last_msg&&P(t.last_msg);i.get(".wpstg-loader").hide(),i.get("#wpstg-processing-header").html("Processing Complete"),e("#wpstg-processing-status").text("Succesfully finished"),i.get("#wpstg_staging_name").html(o.data.cloneID),i.get("#wpstg-finished-result").show(),i.get("#wpstg-cancel-cloning").hide(),i.get("#wpstg-resume-cloning").hide(),i.get("#wpstg-cancel-cloning-update").prop("disabled",!0);var n=i.get("#wpstg-clone-url-1"),a=i.get("#wpstg-clone-url");n.attr("href",t.url),n.html(t.url),a.attr("href",t.url),i.get("#wpstg-remove-clone").data("clone",o.data.cloneID),o.isFinished=!0,o.timer("stop"),i.get(".wpstg-loader").hide(),i.get("#wpstg-processing-header").html("Processing Complete");var r=wpstg.i18n.cloneResetComplete;"wpstg_update"===o.data.action&&(r=wpstg.i18n.cloneUpdateComplete);"wpstg_update"!==o.data.action&&"wpstg_reset"!==o.data.action||Swal.fire({title:"",icon:"success",html:r,width:"500px",focusConfirm:!0})}(n))}),"json",!1)},s=function(e,t){if(void 0===e.percentage)return!1;"database"===e.job&&(i.get("#wpstg-progress-db").width(.2*e.percentage+"%").html(e.percentage+"%"),i.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Step 1 of 4 Cloning Database Tables...")),"SearchReplace"===e.job&&(i.get("#wpstg-progress-db").css("background-color","#3bc36b"),i.get("#wpstg-progress-db").html("1. Database"),i.get("#wpstg-progress-db").width("20%"),i.get("#wpstg-progress-sr").width(.1*e.percentage+"%").html(e.percentage+"%"),i.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Step 2 of 4 Preparing Database Data...")),"directories"===e.job&&(i.get("#wpstg-progress-sr").css("background-color","#3bc36b"),i.get("#wpstg-progress-sr").html("2. Data"),i.get("#wpstg-progress-sr").width("10%"),i.get("#wpstg-progress-dirs").width(.1*e.percentage+"%").html(e.percentage+"%"),i.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Step 3 of 4 Getting files...")),"files"===e.job&&(i.get("#wpstg-progress-dirs").css("background-color","#3bc36b"),i.get("#wpstg-progress-dirs").html("3. Files"),i.get("#wpstg-progress-dirs").width("10%"),i.get("#wpstg-progress-files").width(.6*e.percentage+"%").html(e.percentage+"%"),i.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Step 4 of 4 Copy files...")),"finish"===e.job&&(i.get("#wpstg-progress-files").css("background-color","#3bc36b"),i.get("#wpstg-progress-files").html("4. Copy Files"),i.get("#wpstg-progress-files").width("60%"),i.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Cloning Process Finished"))}}},o.switchStep=function(e){i.get(".wpstg-current-step").removeClass("wpstg-current-step"),i.get(".wpstg-step"+e).addClass("wpstg-current-step")},o.init=function(){var t,s,a,r;D(),s=i.get("#wpstg-workflow"),a=!0,r=ajaxurl.replace("/admin-ajax.php","")+"/images/spinner",2<window.devicePixelRatio&&(r+="-2x"),n="<img src=''"+(r+=".gif")+"' alt='' class='ajax-spinner general-spinner' />",s.on("click",".wpstg-button-unselect",(function(e){e.preventDefault(),!1===a?(i.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected","selected"),i.get(".wpstg-button-unselect").text("Unselect All"),i.get(".wpstg-db-table-checkboxes").prop("checked",!0),a=!0):(i.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected",!1),i.get(".wpstg-button-unselect").text("Select All"),i.get(".wpstg-db-table-checkboxes").prop("checked",!1),a=!1)})).on("click",".wpstg-button-select",(function(t){t.preventDefault(),e("#wpstg_select_tables_cloning .wpstg-db-table").each((function(){1==wpstg.isMultisite&&(e(this).attr("name").match("^"+wpstg.tblprefix+"([^0-9])_*")?e(this).prop("selected","selected"):e(this).prop("selected",!1)),0==wpstg.isMultisite&&(e(this).attr("name").match("^"+wpstg.tblprefix)?e(this).prop("selected","selected"):e(this).prop("selected",!1))}))})).on("click",".wpstg-expand-dirs",(function(t){t.preventDefault(),e(this).siblings(".wpstg-subdir").slideToggle()})).on("change","input.wpstg-check-dir",(function(){var t=e(this).parent(".wpstg-dir");this.checked?(t.parents(".wpstg-dir").children(".wpstg-check-dir").prop("checked",!0),t.find(".wpstg-expand-dirs").removeClass("disabled"),t.find(".wpstg-subdir .wpstg-check-dir").prop("checked",!0)):(t.find(".wpstg-dir .wpstg-check-dir").prop("checked",!1),t.find(".wpstg-expand-dirs, .wpstg-check-subdirs").addClass("disabled"),t.find(".wpstg-check-subdirs").data("action","check").text("check"))})).on("change","href.wpstg-check-dir",(function(){var t=e(this).parent(".wpstg-dir");this.checked?(t.parents(".wpstg-dir").children(".wpstg-check-dir").prop("checked",!0),t.find(".wpstg-expand-dirs").removeClass("disabled"),t.find(".wpstg-subdir .wpstg-check-dir").prop("checked",!0)):(t.find(".wpstg-dir .wpstg-check-dir").prop("checked",!1),t.find(".wpstg-expand-dirs, .wpstg-check-subdirs").addClass("disabled"),t.find(".wpstg-check-subdirs").data("action","check").text("check"))})).on("keyup","#wpstg-new-clone-id",(function(){document.getElementById("wpstg-error-details").style.display="none","number"==typeof t&&clearInterval(t);var e=this.value;t=setTimeout((function(){k({action:"wpstg_check_clone",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneID:e},(function(e){"success"===e.status?(i.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),i.get("#wpstg-start-cloning").removeAttr("disabled"),i.get("#wpstg-clone-id-error").text("").hide()):(i.get("#wpstg-new-clone-id").addClass("wpstg-error-input"),i.get("#wpstg-start-cloning").prop("disabled",!0),i.get("#wpstg-clone-id-error").text(e.message).show())}))}),500)})).on("click","#wpstg-start-cloning",(function(){f(),o.isCancelled=!1,o.getLogs=!1,o.progressBar=0})).on("input","#wpstg-new-clone-id",(function(){if(!(e("#wpstg-clone-directory").length<1)){var t=this.value.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,""),s=e("#wpstg-use-target-dir"),n=e("#wpstg-use-target-hostname"),a=s.data("base-path"),o=n.data("base-uri");a&&(a=a.replace(/\/+$/g,"")+"/"+t+"/"),o&&(o=o.replace(/\/+$/g,"")+"/"+t),e(".wpstg-use-target-dir--value").text(a),e(".wpstg-use-target-hostname--value").text(o),s.attr("data-path",a),n.attr("data-uri",o),e("#wpstg_clone_dir").attr("placeholder",a),e("#wpstg_clone_hostname").attr("placeholder",o)}})).on("input","#wpstg_clone_hostname",(function(){""===e(this).val()||m()?e("#wpstg_clone_hostname_error").remove():m()||e("#wpstg_clone_hostname_error").length||e("#wpstg-clone-directory tr:last-of-type").after('<tr><td>&nbsp;</td><td><p id="wpstg_clone_hostname_error" style="color: red;">&nbsp;Invalid host name. Please provide it in a format like http://example.com</p></td></tr>')})),b(),function(){var t=i.get("#wpstg-workflow");t.on("click",".wpstg-next-step-link",(function(s){s.preventDefault();var n=e(this);if(e("#wpstg_clone_hostname").length&&!m())return e("#wpstg_clone_hostname").focus(),!1;if("wpstg_update"===n.data("action")||"wpstg_reset"===n.data("action")){var a="";if("wpstg_update"===n.data("action")&&(a=" \n\nExclude all tables and folders you do not want to overwrite, first! \n\nDo not cancel the updating process! This can break your staging site. \n\nCreate a backup of your staging website before you proceed."),!confirm("STOP! This will overwrite your staging site with all selected data from the production site! This should be used only if you want to clone again your production site. Are you sure you want to do this?"+a))return!1}if(n.attr("disabled"))return!1;"wpstg_cloning"===n.data("action")&&e("#wpstg-ext-db").is(":checked")?x(n,t):C(n,t)})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),i.get(".wpstg-loader").removeClass("wpstg-finished"),i.get(".wpstg-loader").hide(),D()}))}(),i.get("#wpstg-workflow").on("click",".wpstg-tab-header",(function(t){t.preventDefault();var s=e(this),n=i.get(s.data("id"));s.toggleClass("expand"),n.slideToggle(),s.hasClass("expand")?s.find(".wpstg-tab-triangle").html("&#9660;"):s.find(".wpstg-tab-triangle").html("&#9658;")})),e(".wpstg--tab--header a[data-target]").on("click",(function(){var t=e(this),s=t.attr("data-target"),n=t.parents(".wpstg--tab--wrapper"),a=n.find(".wpstg--tab--header a[data-target]");n.find(".wpstg--tab--contents > .wpstg--tab--content").filter(".wpstg--tab--active:not(.wpstg--tab--active"+s+")").removeClass("wpstg--tab--active"),a.not(t).removeClass("wpstg--tab--active"),t.addClass("wpstg--tab--active"),e(s).addClass("wpstg--tab--active"),"#wpstg--tab--backup"===s&&o.backups.init(),"#wpstg--tab--database-backups"===s&&window.dispatchEvent(new Event("database-backups-tab"))})),new p},o.ajax=k,o.showError=r,o.getLogs=P,o.loadOverview=D,o.backups={type:null,isCancelled:!1,processInfo:{title:null,interval:null},modal:{create:{html:null,confirmBtnTxt:null},process:{html:null,cancelBtnTxt:null,modal:null},download:{html:null},import:{html:null,btnTxtNext:null,btnTxtConfirm:null,btnTxtCancel:null,searchReplaceForm:null,file:null,containerUpload:null,containerFilesystem:null,setFile:function(t,s){void 0===s&&(s=!0);var n,a;t&&(o.backups.modal.import.file=t,o.backups.modal.import.data.file=t.name,e(".wpstg--backup--import--selected-file").html(t.name+" <br /> ("+(n=t.size,a=Math.floor(Math.log(n)/Math.log(1024)),1*(n/Math.pow(1024,a)).toFixed(2)+" "+["B","kB","MB","GB","TB"][a]+")")).show(),e(".wpstg--drag").hide(),e(".wpstg--drag-or-upload").show(),s&&(e(".wpstg--modal--actions .swal2-confirm").prop("disabled",!0),o.backups.upload.start()))},baseDirectory:null,data:{file:null,search:[],replace:[]}}},messages:{WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[]},shouldWarn:function(){return o.backups.messages.data.error.length>0||o.backups.messages.data.critical.length>0},countByType:function(e){return void 0===e&&(e=o.backups.messages.ERROR),o.backups.messages.data[e].length},addMessage:function(e){if(Array.isArray(e))e.forEach((function(e){o.backups.messages.addMessage(e)}));else{var t=e.type.toLowerCase()||"info";o.backups.messages.data[t]||(o.backups.messages.data[t]=[]),o.backups.messages.data.all.push(e),o.backups.messages.data[t].push(e)}},reset:function(){o.backups.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[]}}},timer:{totalSeconds:0,interval:null,start:function(){if(null===o.backups.timer.interval){o.backups.timer.interval=setInterval((function(){var t;e(".wpstg--modal--process--elapsed-time").text((t=o.backups.timer.totalSeconds,""+new Date(1e3*t).toISOString().substr(11,8))),o.backups.timer.totalSeconds++}),1e3)}},stop:function(){o.backups.timer.totalSeconds=0,o.backups.timer.interval&&(clearInterval(o.backups.timer.interval),o.backups.timer.interval=null)}},upload:{reader:null,file:null,iop:1024e3,uploadInfo:function(t){var s=e(".wpstg--modal--import--upload--process"),n=e(".wpstg--uploader");if(t)return s.css("display","flex"),void n.hide();n.css("display","flex"),s.hide()},start:function(){o.backups.upload.reader=new FileReader,o.backups.upload.file=o.backups.modal.import.file,o.backups.upload.uploadInfo(!0),o.backups.upload.sendChunk()},sendChunk:function(t){if(void 0===t&&(t=0),o.backups.upload.file){var s=t<1,n=t+o.backups.upload.iop+1,a=o.backups.upload.file.slice(t,n);o.backups.upload.reader.onloadend=function(a){if(a.target.readyState===FileReader.DONE){var i=new FormData;i.append("accessToken",wpstg.accessToken),i.append("nonce",wpstg.nonce),i.append("data",a.target.result),i.append("filename",o.backups.upload.file.name),i.append("reset",s?"1":"0"),fetch(ajaxurl+"?action=wpstg--backups--import--file-upload",{method:"POST",body:i}).then(l).then((function(e){return e.json()})).then((function(s){c(s,"","Submit an error report.");var a=t+o.backups.upload.iop,i=Math.floor(a/o.backups.upload.file.size*100);if(n>=o.backups.upload.file.size)return o.backups.upload.uploadInfo(!1),L(!1),void o.backups.switchModalToConfigure();e(".wpstg--modal--import--upload--progress--title > span").text(i),e(".wpstg--modal--import--upload--progress").css("width",i+"%"),o.backups.upload.sendChunk(n)})).catch((function(e){return c(e,"","Submit an error report.")}))}},o.backups.upload.reader.readAsDataURL(a)}}},status:{hasResponse:null,reTryAfter:5e3},init:function(){this.create(),this.delete(),this.edit(),o.backups.fetchListing(),e("body").on("click",".wpstg--backup--download",(function(){var e=this.getAttribute("data-url");e.length>0?window.location.href=e:o.backups.downloadModal({titleExport:this.getAttribute("data-title-export"),title:this.getAttribute("data-title"),id:this.getAttribute("data-id"),btnTxtCancel:this.getAttribute("data-btn-cancel-txt"),btnTxtConfirm:this.getAttribute("data-btn-download-txt")})})).on("click",".wpstg--backup--import",(function(){o.backups.importModal(),o.backups.modal.import.data.file=this.getAttribute("data-filePath"),o.backups.switchModalToConfigure()})).off("click","#wpstg-import-backup").on("click","#wpstg-import-backup",(function(){o.backups.importModal()})).off("click",".wpstg--backup--import--choose-option").on("click",".wpstg--backup--import--choose-option",(function(){var t=e(this),s=t.parent();s.hasClass("wpstg--show-options")?(s.removeClass("wpstg--show-options"),t.text(t.attr("data-txtOther"))):(s.addClass("wpstg--show-options"),t.text(t.attr("data-txtChoose")))})).off("click",".wpstg--modal--backup--import--search-replace--new").on("click",".wpstg--modal--backup--import--search-replace--new",(function(t){t.preventDefault();var s=e(Swal.getContainer()).find(".wpstg--modal--backup--import--search-replace--input--container"),n=s.find(".wpstg--modal--backup--import--search-replace--input-group").length;s.append(o.backups.modal.import.searchReplaceForm.replace(/{i}/g,n))})).off("click",".wpstg--modal--backup--import--search-replace--remove").on("click",".wpstg--modal--backup--import--search-replace--remove",(function(t){t.preventDefault(),e(t.target).closest(".wpstg--modal--backup--import--search-replace--input-group").remove()})).off("input",".wpstg--backup--import--search").on("input",".wpstg--backup--import--search",(function(){var e=parseInt(this.getAttribute("data-index"));isNaN(e)||(o.backups.modal.import.data.search[e]=this.value)})).off("input",".wpstg--backup--import--replace").on("input",".wpstg--backup--import--replace",(function(){var e=parseInt(this.getAttribute("data-index"));isNaN(e)||(o.backups.modal.import.data.replace[e]=this.value)})).off("click",".wpstg--backup--import--option[data-option]").on("click",".wpstg--backup--import--option[data-option]",(function(){var t=this.getAttribute("data-option");"file"!==t?("upload"===t&&(o.backups.modal.import.containerFilesystem.hide(),o.backups.modal.import.containerUpload.show()),"filesystem"===t&&(o.backups.modal.import.containerUpload.hide(),o.backups.modal.import.containerFilesystem.show(),fetch(ajaxurl+"?action=wpstg--backups--import--file-list&_="+Math.random()+"&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce).then(l).then((function(e){return e.json()})).then((function(t){var s=e(".wpstg--modal--backup--import--filesystem ul");return s.empty(),!t||function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(t)?(s.append('<span id="wpstg--backups--import--file-list-empty">'+wpstg.i18n.noImportFileFound+"</span><br />"),void e(".wpstg--modal--backup--import--search-replace--wrapper").hide()):(s.append('<span id="wpstg--backups--import--file-list">'+wpstg.i18n.selectFileToImport+"</span><br />"),t.forEach((function(e,t){s.append('\n<li data-filepath="'+e.fullPath+'" class="wpstg--backups--import--file-list--sigle-item">\n    <ul class="wpstg-import-backup-more-info wpstg-import-backup-more-info-'+t+'">\n        <li style="font-weight: bold">'+e.backupName+"</li>\n        <li>Created on: "+e.dateCreatedFormatted+"</li>\n        <li>Size: "+e.size+'</li>\n        <li>\n            <div class="wpstg-import-backup-contains-title">This backup contains:</div>\n            <ul class="wpstg-import-backup-contains">\n            '+(e.isExportingDatabase?"<li><span class=\"dashicons dashicons-database wpstg--tooltip\"><div class='wpstg--tooltiptext'>Database</div></span></li>":"")+"\n            "+(e.isExportingPlugins?"<li><span class=\"dashicons dashicons-admin-plugins wpstg--tooltip\"><div class='wpstg--tooltiptext'>Plugins</div></span></li>":"")+"\n            "+(e.isExportingMuPlugins?"<li><span class=\"dashicons dashicons-plugins-checked wpstg--tooltip\"><div class='wpstg--tooltiptext'>Mu-plugins</div></span></li>":"")+"\n            "+(e.isExportingThemes?"<li><span class=\"dashicons dashicons-layout wpstg--tooltip\"><div class='wpstg--tooltiptext'>Themes</div></span></li>":"")+"\n            "+(e.isExportingUploads?"<li><span class=\"dashicons dashicons-images-alt wpstg--tooltip\"><div class='wpstg--tooltiptext'>Uploads</div></span></li>":"")+"\n            "+(e.isExportingOtherWpContentFiles?"<li><span class=\"dashicons dashicons-admin-generic wpstg--tooltip\"><div class='wpstg--tooltiptext'>Other files in wp-content</div></span></li>":"")+"\n            </ul>\n        </li>\n        <li>Filename: "+e.name+"</li>\n    </ul>\n</li>\n")})),t)})).catch((function(e){return c(e,"","Submit an error report.")})))):e('input[type="file"][name="wpstg--backup--import--upload--file"]').trigger("click")})).off("change",'input[type="file"][name="wpstg--backup--import--upload--file"]').on("change",'input[type="file"][name="wpstg--backup--import--upload--file"]',(function(){o.backups.modal.import.setFile(this.files[0]||null)})).off("change",'input[type="radio"][name="backup_import_file"]').on("change",'input[type="radio"][name="backup_import_file"]',(function(){e(".wpstg--modal--actions .swal2-confirm").show(),e(".wpstg--modal--actions .swal2-confirm").prop("disabled",!1),o.backups.modal.import.data.file=this.value})).on("drag dragstart dragend dragover dragenter dragleave drop",".wpstg--modal--backup--import--upload--container",(function(e){e.preventDefault(),e.stopPropagation()})).on("dragover dragenter",".wpstg--modal--backup--import--upload--container",(function(){e(this).addClass("wpstg--has-dragover")})).on("dragleave dragend drop",".wpstg--modal--backup--import--upload--container",(function(){e(this).removeClass("wpstg--has-dragover")})).on("drop",".wpstg--modal--backup--import--upload--container",(function(e){o.backups.modal.import.setFile(e.originalEvent.dataTransfer.files[0]||null)})).on("click",".wpstg--modal--backup--import--filesystem li",(function(t){var s=e(t.target).closest(".wpstg--backups--import--file-list--sigle-item").data().filepath;s.length?(o.backups.modal.import.data.file=s,o.backups.switchModalToConfigure()):alert("Error: Could not get file path.")})).on("change",'.wpstg-advanced-options-site input[type="checkbox"]',(function(e){setTimeout((function(e){document.getElementById("exportUploadsWithoutDatabaseWarning").style.display="none";var t=document.getElementById("includeDatabaseInBackup").checked;document.getElementById("includeMediaLibraryInBackup").checked&&!t&&(document.getElementById("exportUploadsWithoutDatabaseWarning").style.display="block")}),100)}))},fetchListing:function(e){return void 0===e&&(e=!0),L(!0),e&&f(),fetch(ajaxurl+"?action=wpstg--backups--listing&_="+Math.random()+"&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce).then(l).then((function(e){return e.json()})).then((function(e){return c(e,"","Submit an error report."),i.get("#wpstg--tab--backup").html(e),L(!1),window.dispatchEvent(new Event("backupListingFinished")),e})).catch((function(e){return c(e,"","Submit an error report.")}))},delete:function(){e("#wpstg--tab--backup").off("click",".wpstg-delete-backup[data-md5]").on("click",".wpstg-delete-backup[data-md5]",(function(e){if(e.preventDefault(),f(),confirm("Are you sure you want to delete this backup?")){L(!0),i.get("#wpstg-existing-backups").hide();var t=this.getAttribute("data-md5");o.ajax({action:"wpstg--backups--delete",md5:t,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){c(e,""," Please submit an error report by using the REPORT ISSUE button."),L(!1),o.backups.fetchListing()}))}})),e("#wpstg-error-wrapper").off("click","#wpstg-backup-force-delete").on("click","#wpstg-backup-force-delete",(function(e){e.preventDefault(),f(),L(!0);var t=this.getAttribute("data-id");if(!confirm("Do you want to delete this backup "+t+" from the listed backups?"))return L(!1),!1;o.ajax({action:"wpstg--backups--delete",id:t,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){c(e,""," Please submit an error report by using the REPORT ISSUE button."),o.backups.fetchListing(),L(!1)}))}))},create:function(){var s=function t(){if(f(),!o.backups.isCancelled){var s=function(){clearInterval(o.backups.processInfo.interval),o.backups.processInfo.interval=null};h.ajax({action:"wpstg--backups--export",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(n){if(void 0!==n)if(o.backups.processResponse(n),o.backups.processInfo.interval||null===o.backups.processInfo.interval&&(o.backups.processInfo.interval=setInterval((function(){!0!==o.backups.isCancelled?!1!==o.backups.status.hasResponse&&(o.backups.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce).then((function(e){return e.json()})).then((function(t){if(o.backups.status.hasResponse=!0,void 0===t&&s(),o.backups.processInfo.title!==t.currentStatusTitle){o.backups.processInfo.title=t.currentStatusTitle;var n=e(Swal.getContainer());n.find(".wpstg--modal--process--title").text(t.currentStatusTitle),n.find(".wpstg--modal--process--percent").text("0")}})).catch((function(e){o.backups.status.hasResponse=!0,c(e,"","Submit an error report.")}))):s()}),5e3)),!1===n.status)t();else if(!0===n.status){if(e("#wpstg--progress--status").text("Backup successfully created!"),o.backups.type=null,o.backups.messages.shouldWarn())return o.backups.fetchListing(),void o.backups.logsModal();s(),Swal.close(),o.backups.fetchListing().then((function(){if(n.backupMd5)var t="",s=0,a=setInterval((function(){if(s++,(t=e('.wpstg--backup--download[data-md5="'+n.backupMd5+'"]')).length){clearInterval(a);var i=n.hasOwnProperty("backupSize")?" ("+n.backupSize+")":"";o.backups.downloadModal({id:t.data("id"),url:t.data("url"),title:t.data("title"),titleExport:t.data("title-export"),btnTxtCancel:t.data("btn-cancel-txt"),btnTxtConfirm:t.data("btn-download-txt")+i}),e(".wpstg--modal--download--logs--wrapper").show();var r=e(".wpstg--modal--process--logs");o.backups.messages.data.all.forEach((function(e){var t="wpstg--modal--process--msg--"+e.type.toLowerCase();r.append('<p class="'+t+'">['+e.type+"] - ["+e.date+"] - "+e.message+"</p>")}))}else s>=10&&clearInterval(a)}),200);else r("Failed to get backup md5 from response")}))}else setTimeout((function(){t()}),wpstg.delayReq);else setTimeout((function(){t()}),wpstg.delayReq)}),"json",!1,0,1.25)}};e("body").off("click",".wpstg--tab--toggle").on("click",".wpstg--tab--toggle",(function(){var t=e(this),s=e(t.attr("data-target"));s.toggle(),s.is(":visible")?t.find("span").text("▼"):t.find("span").text("►")})).off("change",'[name="includedDirectories[]"], input#includeDatabaseInBackup, input#includeOtherFilesInWpContent').on("change",'[type="checkbox"][name="includedDirectories[]"], input#includeDatabaseInBackup, input#includeOtherFilesInWpContent',(function(){var t=e('[type="checkbox"][name="includedDirectories[]"]:checked').length>0,s=1===e("input#includeDatabaseInBackup:checked").length,n=1===e("input#includeOtherFilesInWpContent:checked").length;t||s||n?e(".swal2-confirm").prop("disabled",!1):e(".swal2-confirm").prop("disabled",!0)})),e("#wpstg--tab--backup").off("click","#wpstg-new-backup").on("click","#wpstg-new-backup",function(){var n=t(regeneratorRuntime.mark((function t(n){var a,i,r,l,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f(),n.preventDefault(),o.backups.isCancelled=!1,o.backups.modal.create.html&&o.backups.modal.create.confirmBtnTxt||(a=e("#wpstg--modal--backup--new"),i=a.html(),r=a.attr("data-confirmButtonText"),o.backups.modal.create.html=i||null,o.backups.modal.create.confirmBtnTxt=r||null,a.remove()),t.next=6,Swal.fire({title:"",html:o.backups.modal.create.html,focusConfirm:!1,confirmButtonText:o.backups.modal.create.confirmBtnTxt,showCancelButton:!0,preConfirm:function(){var e=Swal.getContainer();return{name:e.querySelector('input[name="backup_name"]').value||null,isExportingPlugins:null!==e.querySelector("#includePluginsInBackup:checked"),isExportingMuPlugins:null!==e.querySelector("#includeMuPluginsInBackup:checked"),isExportingThemes:null!==e.querySelector("#includeThemesInBackup:checked"),isExportingUploads:null!==e.querySelector("#includeMediaLibraryInBackup:checked"),isExportingOtherWpContentFiles:null!==e.querySelector("#includeOtherFilesInWpContent:checked"),isExportingDatabase:null!==e.querySelector("#includeDatabaseInBackup:checked")}}});case 6:if(l=t.sent,p=l.value){t.next=10;break}return t.abrupt("return");case 10:o.backups.process({execute:function(){var e;o.backups.messages.reset(),e=p,h.ajax({action:"wpstg--backups--prepare-export",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgExportData:e},(function(e){e.success?(o.backups.timer.start(),s()):c(e.data,"","Submit an error report.")}),"json",!1,0,1.25)}});case 11:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}())},switchModalToConfigure:function(){o.backups.modal.import.containerUpload.hide(),o.backups.modal.import.containerFilesystem.hide(),o.backups.modal.import.containerConfigure.show()},edit:function(){e("#wpstg--tab--backup").off("click",".wpstg--backup--edit[data-md5]").on("click",".wpstg--backup--edit[data-md5]",function(){var s=t(regeneratorRuntime.mark((function t(s){var n,a,i,r,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.preventDefault(),n=e(this),a=n.data("name"),i=n.data("notes"),t.next=6,Swal.fire({title:"",html:'\n                    <label id="wpstg-backup-edit-name">Backup Name</label>\n                    <input id="wpstg-backup-edit-name-input" class="swal2-input" value="'+a+'">\n                    <label>Additional Notes</label>\n                    <textarea id="wpstg-backup-edit-notes-textarea" class="swal2-textarea">'+i+"</textarea>\n                  ",focusConfirm:!1,confirmButtonText:"Update Backup",showCancelButton:!0,preConfirm:function(){return{name:document.getElementById("wpstg-backup-edit-name-input").value||null,notes:document.getElementById("wpstg-backup-edit-notes-textarea").value||null}}});case 6:if(r=t.sent,l=r.value){t.next=10;break}return t.abrupt("return");case 10:o.ajax({action:"wpstg--backups--edit",accessToken:wpstg.accessToken,nonce:wpstg.nonce,md5:n.data("md5"),name:l.name,notes:l.notes},(function(e){c(e,"","Submit an error report."),o.backups.fetchListing()}));case 11:case"end":return t.stop()}}),t,this)})));return function(e){return s.apply(this,arguments)}}())},cancel:function(){o.backups.timer.stop(),o.backups.isCancelled=!0,Swal.close(),setTimeout((function(){return o.ajax({action:"wpstg--backups--cancel",accessToken:wpstg.accessToken,nonce:wpstg.nonce,type:o.backups.type},(function(e){c(e,"","Submit an error report.")}))}),500)},process:function(t){if(!("function"==typeof t.execute||t.data&&t.onResponse))return Swal.close(),void r("process.data and / or process.onResponse is not set");if(!o.backups.modal.process.html||!o.backups.modal.process.cancelBtnTxt){var s=e("#wpstg--modal--backup--process"),n=s.html(),a=s.attr("data-cancelButtonText");o.backups.modal.process.html=n||null,o.backups.modal.process.cancelBtnTxt=a||null,s.remove()}e("body").off("click",".wpstg--modal--process--logs--tail").on("click",".wpstg--modal--process--logs--tail",(function(t){t.preventDefault();var s=Swal.getContainer(),n=e(s).find(".wpstg--modal--process--logs");n.toggle(),n.is(":visible")?(s.childNodes[0].style.width="100%",s.style["z-index"]=9999):s.childNodes[0].style.width="600px"})),t.isShowCancelButton=!1!==t.isShowCancelButton,o.backups.modal.process.modal=Swal.mixin({customClass:{cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",content:"wpstg--process--content"},buttonsStyling:!1}).fire({html:o.backups.modal.process.html,cancelButtonText:o.backups.modal.process.cancelBtnTxt,showCancelButton:t.isShowCancelButton,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,width:600,onRender:function(){var e=Swal.getContainer().getElementsByClassName("swal2-cancel wpstg--btn--cancel")[0],s=e.cloneNode(!0);if(e.parentNode.replaceChild(s,e),s.addEventListener("click",(function(e){confirm("Are You Sure? This will cancel the process!")&&Swal.close()})),"function"!=typeof t.execute)return t.data&&t.onResponse?void o.ajax(t.data,t.onResponse):(Swal.close(),void r("process.data and / or process.onResponse is not set"));t.execute()},onAfterClose:function(){return"function"==typeof t.onAfterClose&&t.onAfterClose()},onClose:function(){o.backups.cancel()}})},processResponse:function(t,s){if(null===t)throw Swal.close(),r("Invalid Response; null"),new Error("Invalid Response; "+t);var n=e(Swal.getContainer());(t.title||t.statusTitle)&&!0===s&&n.find(".wpstg--modal--process--title").text(t.title||t.statusTitle),t.percentage&&n.find(".wpstg--modal--process--percent").text(t.percentage),function(){if(t.messages){for(var e,s=n.find(".wpstg--modal--process--logs"),i=[o.backups.messages.ERROR,o.backups.messages.CRITICAL],r=function e(t){if(Array.isArray(t))for(var n,r=a(t);!(n=r()).done;){e(n.value)}else{var c="wpstg--modal--process--msg--"+t.type.toLowerCase();s.append('<p class="'+c+'">['+t.type+"] - ["+t.date+"] - "+t.message+"</p>"),i.includes(t.type.toLowerCase())&&(o.backups.cancel(),setTimeout(o.backups.logsModal,500))}},c=a(t.messages);!(e=c()).done;){var l=e.value;l&&(o.backups.messages.addMessage(l),r(l))}if(s.is(":visible")&&s.scrollTop(s[0].scrollHeight),o.backups.messages.shouldWarn()){var p=n.find(".wpstg--modal--process--logs--tail");p.html(p.attr("data-txt-bad")),p.find(".wpstg--modal--logs--critical-count").text(o.backups.messages.countByType(o.backups.messages.CRITICAL)),p.find(".wpstg--modal--logs--error-count").text(o.backups.messages.countByType(o.backups.messages.ERROR)),p.find(".wpstg--modal--logs--warning-count").text(o.backups.messages.countByType(o.backups.messages.WARNING))}}}(),!0===t.status&&!0===t.job_done&&(o.backups.timer.stop(),o.backups.isCancelled=!0)},requestData:function(e,t){var s={},n=e.split("."),a=n.length-1;return n.reduce((function(e,s,n){return e[s]=n>=a?t:{}}),s),s},logsModal:function(){Swal.fire({html:'<div class="wpstg--modal--error--logs" style="display:block"></div><div class="wpstg--modal--process--logs" style="display:block"></div>',width:"95%",onRender:function(){var t=e(Swal.getContainer());t[0].style["z-index"]=9999;var s=t.find(".wpstg--modal--process--logs"),n=t.find(".wpstg--modal--error--logs"),i=e("#wpstg--js--translations"),r=o.backups.messages,c=i.attr("data-modal-logs-title").replace("{critical}",r.countByType(r.CRITICAL)).replace("{errors}",r.countByType(r.ERROR)).replace("{warnings}",r.countByType(r.WARNING));n.before("<h3>"+c+"</h3>");var l=[o.backups.messages.CRITICAL,o.backups.messages.ERROR,o.backups.messages.WARNING];o.backups.messages.shouldWarn()||n.hide();for(var p,u=a(r.data.all);!(p=u()).done;){var d=p.value,g="wpstg--modal--process--msg--"+d.type.toLowerCase();l.includes(d.type)&&n.append('<p class="'+g+'">['+d.type+"] - ["+d.date+"] - "+d.message+"</p>"),s.append('<p class="'+g+'">['+d.type+"] - ["+d.date+"] - "+d.message+"</p>")}},onOpen:function(t){var s=e(t).find(".wpstg--modal--process--logs");s.scrollTop(s[0].scrollHeight)}})},downloadModal:function(t){var s=t.title,n=void 0===s?null:s,a=t.titleExport,i=void 0===a?null:a,r=t.id,c=void 0===r?null:r,l=t.url,p=void 0===l?null:l,u=t.btnTxtCancel,d=void 0===u?"Cancel":u,g=t.btnTxtConfirm,w=void 0===g?"Download":g;if(null===o.backups.modal.download.html){var h=e("#wpstg--modal--backup--download");o.backups.modal.download.html=h.html(),h.remove()}Swal.mixin({customClass:{cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",actions:"wpstg--modal--actions"},buttonsStyling:!1}).fire({icon:"success",html:o.backups.modal.download.html.replace("{title}",n).replace("{btnTxtLog}","Show Logs"),cancelButtonText:d,confirmButtonText:w,showCancelButton:!0,showConfirmButton:!0}).then((function(e){e&&e.value&&(p&&p.length>0?window.location.href=p:Swal.fire({html:"<h2>"+i+'</h2><span class="wpstg-loader"></span>',showCancelButton:!1,showConfirmButton:!1,onRender:function(){o.ajax({action:"wpstg--backups--export",accessToken:wpstg.accessToken,nonce:wpstg.nonce,id:c},(function(e){if(e&&e.success&&e.data&&!(e.data.length<1)){var t=document.createElement("a");t.style.display="none",t.href=e.data,document.body.appendChild(t),t.click(),document.body.removeChild(t),Swal.close()}}))}}))}))},importModal:function(){var t=function t(s){if(f(),!o.backups.isCancelled){o.backups.timer.start();var n=function(){clearInterval(o.backups.processInfo.interval),o.backups.processInfo.interval=null};h.ajax({action:"wpstg--backups--import",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(s){if(void 0!==s)if(o.backups.processResponse(s,!0),o.backups.processInfo.interval||null===o.backups.processInfo.interval&&(o.backups.processInfo.interval=setInterval((function(){!0!==o.backups.isCancelled?!1!==o.backups.status.hasResponse&&(o.backups.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&process=restore&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce).then((function(e){return e.json()})).then((function(t){if(o.backups.status.hasResponse=!0,void 0===t&&n(),o.backups.processInfo.title!==t.currentStatusTitle){o.backups.processInfo.title=t.currentStatusTitle;var s=e(Swal.getContainer());s.find(".wpstg--modal--process--title").text(t.currentStatusTitle),s.find(".wpstg--modal--process--percent").text("0")}})).catch((function(e){o.backups.status.hasResponse=!0,c(e,"","Submit an error report.")}))):n()}),5e3)),!1===s.status)t();else if(!0===s.status){if(e("#wpstg--progress--status").text("Backup successfully imported!"),o.backups.type=null,o.backups.messages.shouldWarn())return o.backups.fetchListing(),void o.backups.logsModal();n();var a='<div class="wpstg--modal--process--logs">'+e(".wpstg--modal--process--logs").get(1).innerHTML+"</div>",i=a.includes("wpstg--modal--process--msg--warning")||a.includes("wpstg--modal--process--msg--error")?"Issues(s) found! ":"";Swal.fire({icon:"success",title:"Finished",html:'System imported from backup. <br/><span class="wpstg--modal--process--msg-found">'+i+'</span><button class="wpstg--modal--process--logs--tail" data-txt-bad="">Show Logs</button><br/>'+a}),o.backups.fetchListing()}else setTimeout((function(){t()}),wpstg.delayReq);else setTimeout((function(){t()}),wpstg.delayReq)}),"json",!1,0,1.25)}};if(!o.backups.modal.import.html){var s=e("#wpstg--modal--backup--import"),n=s.find(".wpstg--modal--backup--import--search-replace--input--container");o.backups.modal.import.searchReplaceForm=n.html(),n.find(".wpstg--modal--backup--import--search-replace--input-group").remove(),n.html(o.backups.modal.import.searchReplaceForm.replace(/{i}/g,0)),o.backups.modal.import.html=s.html(),o.backups.modal.import.baseDirectory=s.attr("data-baseDirectory"),o.backups.modal.import.btnTxtNext=s.attr("data-nextButtonText"),o.backups.modal.import.btnTxtConfirm=s.attr("data-confirmButtonText"),o.backups.modal.import.btnTxtCancel=s.attr("data-cancelButtonText"),s.remove()}o.backups.modal.import.data.search=[],o.backups.modal.import.data.replace=[],Swal.mixin({customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions"},buttonsStyling:!1}).queue([{html:o.backups.modal.import.html,confirmButtonText:o.backups.modal.import.btnTxtNext,showCancelButton:!1,showConfirmButton:!0,showLoaderOnConfirm:!0,width:650,onRender:function(){e(".wpstg--modal--actions .swal2-confirm").show(),e(".wpstg--modal--actions .swal2-confirm").prop("disabled",!1),o.backups.modal.import.containerUpload=e(".wpstg--modal--backup--import--upload"),o.backups.modal.import.containerFilesystem=e(".wpstg--modal--backup--import--filesystem"),o.backups.modal.import.containerConfigure=e(".wpstg--modal--backup--import--configure")},preConfirm:function(){var e=new FormData;return e.append("accessToken",wpstg.accessToken),e.append("nonce",wpstg.nonce),e.append("filePath",o.backups.modal.import.data.file),o.backups.modal.import.data.search.forEach((function(t,s){e.append("search["+s+"]",t)})),o.backups.modal.import.data.replace.forEach((function(t,s){e.append("replace["+s+"]",t)})),fetch(ajaxurl+"?action=wpstg--backups--import--file-info",{method:"POST",body:e}).then(l).then((function(e){return e.json()})).then((function(e){return Swal.insertQueueStep({html:e,confirmButtonText:o.backups.modal.import.btnTxtConfirm,cancelButtonText:o.backups.modal.import.btnTxtCancel,showCancelButton:!0})})).catch((function(e){return c(e,"","Submit an error report.")}))}}]).then((function(e){if(e&&e.value&&e.value[1]&&!0===e.value[1]){o.backups.isCancelled=!1;var s=o.backups.modal.import.data;s.file=o.backups.modal.import.baseDirectory+s.file,h.ajax({action:"wpstg--backups--prepare-import",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgImportData:s},(function(e){e.success?o.backups.process({execute:function(){o.backups.messages.reset(),t()}}):c(e.data,"","Submit an error report.")}),"json",!1,0,1.25)}}))}},window.addEventListener("backupListingFinished",(function(){fetch(ajaxurl+"?action=wpstg--backups--import--file-list&_="+Math.random()+"&accessToken="+wpstg.accessToken+"&nonce="+wpstg.nonce+"&withTemplate=true").then(l).then((function(e){return e.json()})).then((function(t){var s=e(".wpstg-backup-list ul");s.empty(),s.html(t)})).catch((function(e){return c(e,"","Submit an error report.")}))})),o}(jQuery);jQuery(document).ready((function(){h.init(),window.WPStaging=h})),jQuery(document).ready((function(e){function t(s,n){void 0===n&&(n="false");var a=s.next(),o=e(".wpstg-report-email").val(),i=e(".wpstg-report-hosting-provider").val(),r=e(".wpstg-report-description").val(),c=e(".wpstg-report-syslog").is(":checked"),l=e(".wpstg-report-terms").is(":checked");s.attr("disabled",!0),a.css("visibility","visible"),e.ajax({url:ajaxurl,type:"POST",dataType:"json",async:!0,data:{action:"wpstg_send_report",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg_email:o,wpstg_provider:i,wpstg_message:r,wpstg_syslog:+c,wpstg_terms:+l,wpstg_force_send:n}}).done((function(n){if(s.attr("disabled",!1),a.css("visibility","hidden"),n.errors.length>0){e(".wpstg-report-issue-form .wpstg-message").remove();var o=e("<div />").addClass("wpstg-message wpstg-error-message");e.each(n.errors,(function(e,n){"already_submitted"===n.status?(o="",Swal.fire({title:"",customClass:{container:"wpstg-issue-resubmit-confirmation"},icon:"warning",html:n.message,showCloseButton:!0,showCancelButton:!0,focusConfirm:!1,confirmButtonText:"Yes",cancelButtonText:"No"}).then((function(e){e.isConfirmed&&t(s,"true")}))):o.append("<p>"+n+"</p>")})),e(".wpstg-report-issue-form").prepend(o)}else{var i=e("<div />").addClass("wpstg-message wpstg-success-message");i.append("<p>Thanks for submitting your request! You should receive an auto reply mail with your ticket ID immediately for confirmation!<br><br>If you do not get that mail please contact us directly at <strong>support@wp-staging.com</strong></p>"),e(".wpstg-report-issue-form").html(i),e(".wpstg-success-message").append('<div style="float:right;margin-top:10px;"><a id="wpstg-success-button" href="#">Close</a></div>'),setTimeout((function(){e(".wpstg-report-issue-form").removeClass("wpstg-report-active")}),2e3)}}))}e("#wpstg-report-issue-button").on("click",(function(t){e(".wpstg-report-issue-form").toggleClass("wpstg-report-show"),t.preventDefault()})),e("body").on("click","#wpstg-backups-report-issue-button",(function(t){e(".wpstg-report-issue-form").toggleClass("wpstg-report-show"),t.preventDefault()})),e("#wpstg-report-cancel").on("click",(function(t){e(".wpstg-report-issue-form").removeClass("wpstg-report-show"),t.preventDefault()})),e("body").on("click","#wpstg-success-button",(function(t){t.preventDefault(),e(".wpstg-report-issue-form").removeClass("wpstg-report-show")})),e("#wpstg-report-submit").on("click",(function(s){t(e(this),"false"),s.preventDefault()})),e(document).on("click",".wpstg-dropdown>.wpstg-dropdown-toggler",(function(t){t.preventDefault(),e(t.target).next(".wpstg-dropdown-menu").toggleClass("shown")})),document.addEventListener("click",(function(e){if(!e.target.closest(".wpstg-dropdown-toggler"))for(var t=document.getElementsByClassName("wpstg-dropdown-menu"),s=0;s<t.length;s++)t[s].classList.remove("shown")}))}))}();
//# sourceMappingURL=wpstg-admin.min.js.map
